<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Fracci√≥n Quest - Aventura Espacial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        space: '#0B1426',
                        rocket: '#FF6B35',
                        star: '#FFD700',
                    },
                    animation: {
                        'pop': 'pop 0.5s ease-out',
                        'confetti': 'confetti 0.8s ease-out',
                        'float': 'float 3s ease-in-out infinite',
                        'rocket-move': 'rocket-move 2s ease-in-out infinite',
                        'twinkle': 'twinkle 2s ease-in-out infinite',
                        'planet-rotate': 'planet-rotate 20s linear infinite',
                    },
                    keyframes: {
                        pop: {
                            '0%': { transform: 'scale(0.8)' },
                            '50%': { transform: 'scale(1.1)' },
                            '100%': { transform: 'scale(1)' },
                        },
                        confetti: {
                            '0%': { transform: 'translateY(0) rotate(0deg)', opacity: '1' },
                            '100%': { transform: 'translateY(-20px) rotate(360deg)', opacity: '0' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'rocket-move': {
                            '0%, 100%': { transform: 'translateX(0px) rotate(0deg)' },
                            '50%': { transform: 'translateX(10px) rotate(5deg)' },
                        },
                        twinkle: {
                            '0%, 100%': { opacity: '0.3', transform: 'scale(1)' },
                            '50%': { opacity: '1', transform: 'scale(1.2)' },
                        },
                        'planet-rotate': {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
        }
        .fraction .numerator {
            display: block;
            border-bottom: 2px solid #333;
            padding-bottom: 2px;
        }
        .fraction .denominator {
            display: block;
            padding-top: 2px;
        }
        .dark .fraction .numerator {
            border-bottom-color: #fff;
        }
        .glow {
            box-shadow: 0 0 20px rgba(93, 92, 222, 0.5);
        }
        .space-glow {
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }
        .confetti-piece {
            position: absolute;
            width: 8px;
            height: 8px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            animation: confetti 2s ease-out infinite;
        }
        .lesson-card:hover {
            transform: translateY(-5px);
        }
        .space-bg {
            background: linear-gradient(135deg, #0B1426 0%, #1a202c 50%, #2d3748 100%);
            position: relative;
            overflow: hidden;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
        }
        .star-1 { width: 2px; height: 2px; top: 10%; left: 10%; animation-delay: 0s; }
        .star-2 { width: 3px; height: 3px; top: 20%; left: 80%; animation-delay: 0.5s; }
        .star-3 { width: 2px; height: 2px; top: 40%; left: 15%; animation-delay: 1s; }
        .star-4 { width: 4px; height: 4px; top: 60%; left: 70%; animation-delay: 1.5s; }
        .star-5 { width: 2px; height: 2px; top: 80%; left: 30%; animation-delay: 2s; }
        .star-6 { width: 3px; height: 3px; top: 15%; left: 50%; animation-delay: 0.3s; }
        .mission-complete {
            background: linear-gradient(45deg, #10b981, #34d399);
            animation: pop 0.6s ease-out;
        }
        .mission-locked {
            opacity: 0.6;
            filter: grayscale(100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-100 to-blue-100 dark:from-gray-900 dark:to-purple-900 text-gray-900 dark:text-white min-h-screen">
    <!-- Confetti Container -->
    <div id="confetti-container" class="fixed inset-0 pointer-events-none z-50"></div>
    
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <div class="bg-white dark:bg-gray-800 rounded-3xl p-6 shadow-2xl glow mb-4">
                <h1 class="text-5xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">
                    üéÆ Fracci√≥n Quest
                </h1>
                <p class="text-xl text-gray-600 dark:text-gray-300 mb-4">¬°Convi√©rtete en el Maestro de las Fracciones!</p>
                
                <!-- Player Stats -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mt-6">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-bold">Nivel</span>
                            <span id="player-level" class="text-2xl font-bold bg-white text-purple-600 px-3 py-1 rounded-full">1</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-3 mb-2">
                            <div id="xp-bar" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <div class="text-xs">
                            XP: <span id="current-xp">0</span> / <span id="max-xp">100</span>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-4 text-white">
                        <div class="text-center">
                            <div class="text-3xl font-bold mb-1">üèÜ</div>
                            <div id="total-points" class="text-2xl font-bold">0</div>
                            <div class="text-xs">Puntos</div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-red-500 to-pink-500 rounded-2xl p-4 text-white">
                        <div class="text-center">
                            <div class="text-3xl font-bold mb-1">üî•</div>
                            <div id="streak-count" class="text-2xl font-bold">0</div>
                            <div class="text-xs">Racha</div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-indigo-500 to-cyan-500 rounded-2xl p-4 text-white">
                        <div class="text-center">
                            <div class="text-3xl font-bold mb-1">üöÄ</div>
                            <div id="space-missions" class="text-2xl font-bold">0</div>
                            <div class="text-xs">Misiones</div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-500 to-teal-500 rounded-2xl p-4 text-white">
                        <div class="text-center">
                            <div class="text-3xl font-bold mb-1">üéñÔ∏è</div>
                            <div id="achievement-count" class="text-2xl font-bold">0</div>
                            <div class="text-xs">Logros</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="mb-8">
            <div class="flex flex-wrap justify-center gap-3 mb-4">
                <button onclick="showSection('tutorial')" class="nav-btn bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-2xl hover:from-green-600 hover:to-emerald-700 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    üéì Tutorial
                </button>
                <button onclick="showSection('space')" class="nav-btn bg-gray-300 dark:bg-gray-600 px-6 py-3 rounded-2xl hover:bg-gray-400 dark:hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    üöÄ Aventura Espacial
                </button>
                <button onclick="showSection('challenge')" class="nav-btn bg-gray-300 dark:bg-gray-600 px-6 py-3 rounded-2xl hover:bg-gray-400 dark:hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    ‚ö° Desaf√≠o R√°pido
                </button>
                <button onclick="showSection('practice')" class="nav-btn bg-gray-300 dark:bg-gray-600 px-6 py-3 rounded-2xl hover:bg-gray-400 dark:hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    üèãÔ∏è Pr√°ctica Libre
                </button>
                <button onclick="showSection('visual')" class="nav-btn bg-gray-300 dark:bg-gray-600 px-6 py-3 rounded-2xl hover:bg-gray-400 dark:hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    üëÅÔ∏è Visualizador
                </button>
            </div>
        </nav>

        <!-- Tutorial Section -->
        <section id="tutorial" class="section">
            <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 shadow-2xl mb-6 glow">
                <h2 class="text-3xl font-bold mb-6 text-center bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
                    üéì Academia de Fracciones
                </h2>
                
                <!-- Lesson Selection -->
                <div id="lesson-selection" class="grid lg:grid-cols-3 gap-6">
                    <div onclick="showLessonDetail('basics')" class="lesson-card bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900 dark:to-purple-900 p-6 rounded-2xl cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <div class="text-4xl mb-3">üìö</div>
                        <h3 class="text-xl font-bold mb-2">Conceptos B√°sicos</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Aprende qu√© son las fracciones y sus tipos</p>
                        <div class="mt-4 text-green-600 font-bold">+50 XP</div>
                    </div>
                    
                    <div onclick="showLessonDetail('addition')" class="lesson-card bg-gradient-to-br from-yellow-100 to-orange-100 dark:from-yellow-900 dark:to-orange-900 p-6 rounded-2xl cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <div class="text-4xl mb-3">‚ûï</div>
                        <h3 class="text-xl font-bold mb-2">Suma y Resta</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Domina las operaciones b√°sicas</p>
                        <div class="mt-4 text-green-600 font-bold">+75 XP</div>
                    </div>
                    
                    <div onclick="showLessonDetail('multiply')" class="lesson-card bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900 p-6 rounded-2xl cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <div class="text-4xl mb-3">‚úñÔ∏è</div>
                        <h3 class="text-xl font-bold mb-2">Multiplicaci√≥n y Divisi√≥n</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Operaciones avanzadas</p>
                        <div class="mt-4 text-green-600 font-bold">+100 XP</div>
                    </div>
                </div>
                
                <!-- Lesson Detail Content -->
                <div id="lesson-detail" class="mt-8 hidden">
                    <button onclick="backToLessons()" class="mb-4 bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-colors">
                        ‚Üê Volver a Lecciones
                    </button>
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6">
                        <div id="lesson-content-display"></div>
                        <div class="text-center mt-6">
                            <button onclick="completeLessonDirect()" id="complete-lesson-btn" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-3 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all transform hover:scale-105">
                                Completar Lecci√≥n
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Space Adventure Section -->
        <section id="space" class="section hidden">
            <div class="space-bg rounded-3xl p-8 shadow-2xl mb-6 space-glow relative">
                <!-- Stars Background -->
                <div class="star star-1"></div>
                <div class="star star-2"></div>
                <div class="star star-3"></div>
                <div class="star star-4"></div>
                <div class="star star-5"></div>
                <div class="star star-6"></div>
                
                <h2 class="text-3xl font-bold mb-6 text-center text-white relative z-10">
                    üöÄ Aventura Espacial: Misiones Fraccionarias
                </h2>
                
                <!-- Space Mission Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8 relative z-10">
                    <div class="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl p-4 text-white backdrop-blur-sm">
                        <div class="text-center">
                            <div class="text-2xl mb-2">üåå</div>
                            <div id="current-galaxy" class="text-xl font-bold">Galaxia Alpha</div>
                            <div class="text-sm">Galaxia Actual</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl p-4 text-white backdrop-blur-sm">
                        <div class="text-center">
                            <div class="text-2xl mb-2">üõ∏</div>
                            <div id="ship-level" class="text-xl font-bold">Nave Nivel 1</div>
                            <div class="text-sm">Tu Nave</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-orange-500 to-red-600 rounded-2xl p-4 text-white backdrop-blur-sm">
                        <div class="text-center">
                            <div class="text-2xl mb-2">‚ö°</div>
                            <div id="energy-level" class="text-xl font-bold">100%</div>
                            <div class="text-sm">Energ√≠a</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-green-600 to-teal-600 rounded-2xl p-4 text-white backdrop-blur-sm">
                        <div class="text-center">
                            <div class="text-2xl mb-2">üí´</div>
                            <div id="crystals-collected" class="text-xl font-bold">0</div>
                            <div class="text-sm">Cristales</div>
                        </div>
                    </div>
                </div>

                <!-- Mission Selection -->
                <div id="mission-selection" class="relative z-10">
                    <h3 class="text-2xl font-bold text-white mb-6 text-center">üéØ Selecciona tu Misi√≥n</h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <!-- Mission 1: Basic Operations -->
                        <div onclick="startSpaceMission('basic')" class="mission-card bg-gradient-to-br from-green-400 to-blue-500 p-6 rounded-2xl cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-2xl text-white">
                            <div class="text-center">
                                <div class="text-4xl mb-3 animate-float">ü™ê</div>
                                <h4 class="text-xl font-bold mb-2">Planeta B√°sico</h4>
                                <p class="text-sm mb-4">Operaciones b√°sicas de fracciones</p>
                                <div class="text-lg font-bold">+50 Cristales ‚≠ê</div>
                                <div class="text-sm mt-2">Dificultad: F√°cil</div>
                            </div>
                        </div>

                        <!-- Mission 2: Advanced Operations -->
                        <div onclick="startSpaceMission('advanced')" class="mission-card bg-gradient-to-br from-orange-400 to-red-500 p-6 rounded-2xl cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-2xl text-white">
                            <div class="text-center">
                                <div class="text-4xl mb-3 animate-float" style="animation-delay: 0.5s">üåü</div>
                                <h4 class="text-xl font-bold mb-2">Estrella Dorada</h4>
                                <p class="text-sm mb-4">Operaciones avanzadas y mixtas</p>
                                <div class="text-lg font-bold">+100 Cristales ‚≠ê‚≠ê</div>
                                <div class="text-sm mt-2">Dificultad: Media</div>
                            </div>
                        </div>

                        <!-- Mission 3: Master Challenge -->
                        <div onclick="startSpaceMission('master')" class="mission-card bg-gradient-to-br from-purple-500 to-indigo-600 p-6 rounded-2xl cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-2xl text-white">
                            <div class="text-center">
                                <div class="text-4xl mb-3 animate-float" style="animation-delay: 1s">üåå</div>
                                <h4 class="text-xl font-bold mb-2">Agujero Negro</h4>
                                <p class="text-sm mb-4">Desaf√≠o m√°ximo de fracciones</p>
                                <div class="text-lg font-bold">+200 Cristales ‚≠ê‚≠ê‚≠ê</div>
                                <div class="text-sm mt-2">Dificultad: Experto</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mission Interface -->
                <div id="mission-interface" class="mt-8 hidden relative z-10">
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 text-white">
                        <div class="flex justify-between items-center mb-6">
                            <h3 id="mission-title" class="text-2xl font-bold">üöÄ Misi√≥n en Progreso</h3>
                            <button onclick="exitMission()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-xl transition-colors">
                                üö™ Salir
                            </button>
                        </div>

                        <!-- Mission Progress -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-blue-500/20 rounded-xl p-4 text-center">
                                <div class="text-xl font-bold" id="mission-progress">0/5</div>
                                <div class="text-sm">Problemas Resueltos</div>
                            </div>
                            <div class="bg-green-500/20 rounded-xl p-4 text-center">
                                <div class="text-xl font-bold" id="mission-score">0</div>
                                <div class="text-sm">Puntuaci√≥n</div>
                            </div>
                            <div class="bg-purple-500/20 rounded-xl p-4 text-center">
                                <div class="text-xl font-bold" id="mission-time">60</div>
                                <div class="text-sm">Tiempo (s)</div>
                            </div>
                        </div>

                        <!-- Problem Display -->
                        <div id="space-problem" class="bg-black/30 rounded-xl p-8 mb-6">
                            <div class="text-center">
                                <div class="text-6xl mb-4 animate-rocket-move">üöÄ</div>
                                <h4 class="text-xl mb-4">üõ∏ Mensaje de la nave:</h4>
                                <div id="problem-display" class="text-3xl mb-6 font-bold">
                                    <!-- Problem will be displayed here -->
                                </div>
                                <div id="space-options" class="grid grid-cols-2 gap-4">
                                    <!-- Options will be displayed here -->
                                </div>
                            </div>
                        </div>

                        <!-- Mission Results -->
                        <div id="mission-results" class="hidden bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl p-6 text-center text-black">
                            <h4 class="text-2xl font-bold mb-4">üéâ ¬°Misi√≥n Completada!</h4>
                            <div id="mission-summary" class="text-lg">
                                <!-- Results will be displayed here -->
                            </div>
                            <button onclick="returnToMissions()" class="mt-4 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors">
                                üöÄ Nuevas Misiones
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Other sections remain the same... -->
        <section id="challenge" class="section hidden">
            <div class="bg-gradient-to-br from-orange-100 to-red-100 dark:from-orange-900/30 dark:to-red-900/30 rounded-3xl p-8 shadow-2xl mb-6 space-glow">
                <h2 class="text-3xl font-bold mb-6 text-center bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">
                    ‚ö° Desaf√≠o R√°pido: Operaciones Combinadas
                </h2>
                
                <!-- Challenge Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-yellow-500 to-orange-600 rounded-2xl p-4 text-white text-center">
                        <div class="text-2xl font-bold mb-1" id="challenge-score">0</div>
                        <div class="text-sm">Puntuaci√≥n</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-4 text-white text-center">
                        <div class="text-2xl font-bold mb-1" id="challenge-correct">0</div>
                        <div class="text-sm">Correctas</div>
                    </div>
                    <div class="bg-gradient-to-r from-red-500 to-pink-600 rounded-2xl p-4 text-white text-center">
                        <div class="text-2xl font-bold mb-1" id="challenge-streak">0</div>
                        <div class="text-sm">Racha</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-indigo-600 rounded-2xl p-4 text-white text-center">
                        <div class="text-2xl font-bold mb-1" id="challenge-time">60</div>
                        <div class="text-sm">Tiempo (s)</div>
                    </div>
                </div>

                <!-- Challenge Controls -->
                <div id="challenge-start" class="text-center">
                    <div class="bg-white/70 dark:bg-gray-800/70 p-8 rounded-2xl mb-6">
                        <h3 class="text-2xl font-bold mb-4 text-orange-600">üî• ¬°Ponte a Prueba!</h3>
                        <p class="text-lg mb-6">Resuelve 5 ejercicios combinados que mezclan todas las operaciones con fracciones.</p>
                        <div class="grid md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-r from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30 p-4 rounded-xl">
                                <div class="text-3xl mb-2">üßÆ</div>
                                <h4 class="font-bold">Operaciones Mixtas</h4>
                                <p class="text-sm">Suma, resta, multiplicaci√≥n y divisi√≥n juntas</p>
                            </div>
                            <div class="bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 p-4 rounded-xl">
                                <div class="text-3xl mb-2">‚è±Ô∏è</div>
                                <h4 class="font-bold">Tiempo Limitado</h4>
                                <p class="text-sm">60 segundos para cada problema</p>
                            </div>
                            <div class="bg-gradient-to-r from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30 p-4 rounded-xl">
                                <div class="text-3xl mb-2">üèÜ</div>
                                <h4 class="font-bold">Puntuaci√≥n Extra</h4>
                                <p class="text-sm">+200 XP por desaf√≠o completado</p>
                            </div>
                        </div>
                        <button onclick="startChallenge()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white text-xl px-8 py-4 rounded-2xl hover:from-orange-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg">
                            üöÄ ¬°Comenzar Desaf√≠o!
                        </button>
                    </div>
                </div>

                <!-- Challenge Interface -->
                <div id="challenge-interface" class="hidden">
                    <!-- Progress Bar -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-bold">Progreso:</span>
                            <span id="challenge-progress" class="text-sm font-bold">1/5</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div id="challenge-progress-bar" class="bg-gradient-to-r from-orange-500 to-red-600 h-4 rounded-full transition-all duration-500" style="width: 20%"></div>
                        </div>
                    </div>

                    <!-- Problem Display -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 mb-6 text-center">
                        <div class="text-4xl mb-4" id="challenge-emoji">üßÆ</div>
                        <h3 class="text-xl font-bold mb-4" id="challenge-question-title">Problema 1</h3>
                        <div id="challenge-problem" class="text-4xl mb-6 font-bold text-orange-600">
                            <!-- Problem will be displayed here -->
                        </div>
                        <div id="challenge-options" class="grid grid-cols-2 gap-4">
                            <!-- Options will be displayed here -->
                        </div>
                    </div>

                    <!-- Hint System -->
                    <div id="challenge-hint" class="bg-yellow-100 dark:bg-yellow-900/30 rounded-xl p-4 mb-4 hidden">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">üí°</span>
                            <div>
                                <h4 class="font-bold">Pista:</h4>
                                <p class="text-sm" id="challenge-hint-text"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Challenge Controls -->
                    <div class="flex justify-center gap-4">
                        <button onclick="showHint()" id="hint-btn" class="bg-yellow-500 text-white px-4 py-2 rounded-xl hover:bg-yellow-600 transition-colors">
                            üí° Pista
                        </button>
                        <button onclick="exitChallenge()" class="bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-colors">
                            üö™ Salir
                        </button>
                    </div>
                </div>

                <!-- Challenge Results -->
                <div id="challenge-results" class="hidden">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-8 text-center text-black">
                        <div class="text-6xl mb-4">üéâ</div>
                        <h3 class="text-3xl font-bold mb-4">¬°Desaf√≠o Completado!</h3>
                        <div id="challenge-final-stats" class="text-lg mb-6">
                            <!-- Final stats will be displayed here -->
                        </div>
                        <div class="flex justify-center gap-4">
                            <button onclick="startChallenge()" class="bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors">
                                üîÑ Intentar de Nuevo
                            </button>
                            <button onclick="exitChallenge()" class="bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 transition-colors">
                                ‚úÖ Continuar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="practice" class="section hidden">
            <div class="bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 rounded-3xl p-8 shadow-2xl mb-6 space-glow">
                <h2 class="text-3xl font-bold mb-6 text-center bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                    üèãÔ∏è Pr√°ctica Libre: Ejercicios Mixtos
                </h2>
                
                <!-- Practice Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-blue-500 to-cyan-600 rounded-2xl p-4 text-white text-center">
                        <div class="text-2xl font-bold mb-1" id="practice-completed">0</div>
                        <div class="text-sm">Completados</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-4 text-white text-center">
                        <div class="text-2xl font-bold mb-1" id="practice-correct">0</div>
                        <div class="text-sm">Correctos</div>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-500 to-orange-600 rounded-2xl p-4 text-white text-center">
                        <div class="text-2xl font-bold mb-1" id="practice-accuracy">0%</div>
                        <div class="text-sm">Precisi√≥n</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-pink-600 rounded-2xl p-4 text-white text-center">
                        <div class="text-2xl font-bold mb-1" id="practice-xp">0</div>
                        <div class="text-sm">XP Ganado</div>
                    </div>
                </div>

                <!-- Mode Selection -->
                <div id="practice-mode-selection" class="text-center mb-8">
                    <div class="bg-white/70 dark:bg-gray-800/70 p-8 rounded-2xl mb-6">
                        <h3 class="text-2xl font-bold mb-4 text-blue-600">üìö Elige tu Modalidad de Pr√°ctica</h3>
                        <p class="text-lg mb-6">10 ejercicios mixtos para dominar todas las operaciones con fracciones</p>
                        
                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-gradient-to-r from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30 p-6 rounded-xl">
                                <div class="text-4xl mb-3">üíª</div>
                                <h4 class="text-xl font-bold mb-2">Pr√°ctica Digital</h4>
                                <p class="text-sm mb-4">Resuelve los ejercicios en pantalla con feedback inmediato</p>
                                <button onclick="startDigitalPractice()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all transform hover:scale-105">
                                    üöÄ Comenzar Digital
                                </button>
                            </div>
                            
                            <div class="bg-gradient-to-r from-orange-100 to-red-100 dark:from-orange-900/30 dark:to-red-900/30 p-6 rounded-xl">
                                <div class="text-4xl mb-3">üìÑ</div>
                                <h4 class="text-xl font-bold mb-2">Hoja de Trabajo</h4>
                                <p class="text-sm mb-4">Genera una hoja PDF para imprimir y resolver en papel</p>
                                <button onclick="generateWorksheet()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-6 py-3 rounded-xl hover:from-orange-600 hover:to-red-700 transition-all transform hover:scale-105">
                                    üì• Generar Hoja
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl">
                            <h4 class="font-bold mb-2">üìã Tipos de Ejercicios Incluidos:</h4>
                            <div class="grid md:grid-cols-2 gap-4 text-sm">
                                <ul class="space-y-1">
                                    <li>‚Ä¢ ‚ûï Suma con denominadores diferentes</li>
                                    <li>‚Ä¢ ‚ûñ Resta con m√©todo mariposa</li>
                                    <li>‚Ä¢ ‚úñÔ∏è Multiplicaci√≥n directa</li>
                                    <li>‚Ä¢ ‚ûó Divisi√≥n (invertir y multiplicar)</li>
                                    <li>‚Ä¢ üî¢ Operaciones combinadas</li>
                                </ul>
                                <ul class="space-y-1">
                                    <li>‚Ä¢ üìê Simplificaci√≥n de resultados</li>
                                    <li>‚Ä¢ üîÑ Conversi√≥n a n√∫meros mixtos</li>
                                    <li>‚Ä¢ üéØ Problemas de aplicaci√≥n</li>
                                    <li>‚Ä¢ üßÆ Orden de operaciones</li>
                                    <li>‚Ä¢ ‚≠ê Diferentes niveles de dificultad</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Digital Practice Interface -->
                <div id="digital-practice" class="hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold">üíª Pr√°ctica Digital</h3>
                            <div class="flex gap-3">
                                <span id="practice-progress" class="bg-blue-100 dark:bg-blue-900 px-3 py-1 rounded-full text-sm font-bold">1/10</span>
                                <button onclick="exitPractice()" class="bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-colors">
                                    üö™ Salir
                                </button>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="mb-6">
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div id="practice-progress-bar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-4 rounded-full transition-all duration-500" style="width: 10%"></div>
                            </div>
                        </div>

                        <!-- Exercise Display -->
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-8 mb-6">
                            <div class="text-center">
                                <div class="text-2xl mb-4" id="practice-emoji">üìù</div>
                                <h4 class="text-lg font-bold mb-4" id="practice-title">Ejercicio 1</h4>
                                <div id="practice-exercise" class="text-3xl mb-6 font-bold text-blue-600">
                                    <!-- Exercise will be displayed here -->
                                </div>
                                
                                <!-- Answer Input -->
                                <div class="mb-6">
                                    <p class="text-sm mb-3">Ingresa tu respuesta:</p>
                                    <div class="flex justify-center items-center gap-2 mb-4">
                                        <input type="number" id="answer-numerator" class="w-20 px-3 py-2 text-center text-lg border-2 border-blue-300 rounded-lg focus:border-blue-500" placeholder="Num" min="0">
                                        <span class="text-2xl font-bold">/</span>
                                        <input type="number" id="answer-denominator" class="w-20 px-3 py-2 text-center text-lg border-2 border-blue-300 rounded-lg focus:border-blue-500" placeholder="Den" min="1">
                                    </div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mb-4">
                                        (Si es un n√∫mero entero, coloca 1 en el denominador)
                                    </div>
                                    <button onclick="checkPracticeAnswer()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all transform hover:scale-105">
                                        ‚úÖ Verificar Respuesta
                                    </button>
                                </div>

                                <!-- Hint System -->
                                <div id="practice-hint" class="bg-yellow-100 dark:bg-yellow-900/30 rounded-xl p-4 mb-4 hidden">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">üí°</span>
                                        <div class="text-left">
                                            <h5 class="font-bold">Pista:</h5>
                                            <p class="text-sm" id="practice-hint-text"></p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Result Display -->
                                <div id="practice-result" class="hidden">
                                    <div id="practice-feedback" class="text-lg font-bold mb-3">
                                        <!-- Feedback will be shown here -->
                                    </div>
                                    <div id="practice-explanation" class="text-sm text-left bg-white dark:bg-gray-700 p-4 rounded-lg">
                                        <!-- Explanation will be shown here -->
                                    </div>
                                    <button onclick="nextPracticeExercise()" class="mt-4 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-colors">
                                        ‚û°Ô∏è Siguiente Ejercicio
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Controls -->
                        <div class="flex justify-center gap-4">
                            <button onclick="showPracticeHint()" id="practice-hint-btn" class="bg-yellow-500 text-white px-4 py-2 rounded-xl hover:bg-yellow-600 transition-colors">
                                üí° Pista
                            </button>
                            <button onclick="skipExercise()" class="bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-colors">
                                ‚è≠Ô∏è Saltar
                            </button>
                        </div>
                    </div>

                    <!-- Practice Complete -->
                    <div id="practice-complete" class="hidden bg-gradient-to-r from-green-400 to-blue-500 rounded-2xl p-8 text-center text-white">
                        <div class="text-6xl mb-4">üéâ</div>
                        <h3 class="text-3xl font-bold mb-4">¬°Pr√°ctica Completada!</h3>
                        <div id="practice-final-stats" class="text-lg mb-6">
                            <!-- Final stats will be displayed here -->
                        </div>
                        
                        <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-6">
                            <h4 class="text-xl font-bold mb-3">üéØ ¬øQu√© quieres hacer ahora?</h4>
                            <p class="text-sm mb-4">Contin√∫a tu aprendizaje eligiendo una de estas opciones:</p>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <button onclick="startDigitalPractice()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                                    <div class="flex items-center justify-center gap-2">
                                        <span class="text-xl">üîÑ</span>
                                        <span>Practicar de Nuevo</span>
                                    </div>
                                    <div class="text-xs mt-1 opacity-80">M√°s ejercicios digitales</div>
                                </button>
                                <button onclick="generateWorksheet()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                                    <div class="flex items-center justify-center gap-2">
                                        <span class="text-xl">üìÑ</span>
                                        <span>Hoja de Trabajo</span>
                                    </div>
                                    <div class="text-xs mt-1 opacity-80">Descargar para imprimir</div>
                                </button>
                            </div>
                            <button onclick="exitPractice()" class="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                                <div class="flex items-center justify-center gap-2">
                                    <span class="text-xl">‚úÖ</span>
                                    <span>Volver al Men√∫ Principal</span>
                                </div>
                                <div class="text-xs mt-1 opacity-80">Explorar otras secciones</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Worksheet Preview/Download -->
                <div id="worksheet-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold">üìÑ Hoja de Trabajo: Fracciones Mixtas</h3>
                            <button onclick="closeWorksheet()" class="bg-gray-500 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-colors">
                                ‚úñÔ∏è Cerrar
                            </button>
                        </div>
                        
                        <div class="flex justify-center gap-4 mb-6">
                            <button onclick="printWorksheet()" class="bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors">
                                üñ®Ô∏è Imprimir
                            </button>
                            <button onclick="downloadWorksheet()" class="bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 transition-colors">
                                üì• Descargar PDF
                            </button>
                            <button onclick="generateNewWorksheet()" class="bg-purple-600 text-white px-6 py-3 rounded-xl hover:bg-purple-700 transition-colors">
                                üîÑ Nueva Hoja
                            </button>
                        </div>

                        <div id="worksheet-content" class="bg-white p-8 border rounded-lg">
                            <!-- Worksheet content will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="visual" class="section hidden">
            <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 shadow-2xl mb-6">
                <h2 class="text-3xl font-bold mb-6 text-center">üëÅÔ∏è Visualizador</h2>
                <p class="text-center text-gray-600 dark:text-gray-400">¬°Pr√≥ximamente!</p>
            </div>
        </section>
    </div>

    <script>
        // Game State
        let gameState = {
            level: 1,
            xp: 0,
            totalPoints: 0,
            streak: 0,
            achievements: [],
            currentLesson: null,
            spaceMissions: 0,
            crystals: 0,
            currentGalaxy: 'Alpha',
            shipLevel: 1,
            energy: 100,
            currentMission: null,
            missionProgress: 0,
            missionScore: 0,
            missionTime: 60,
            missionTimer: null
        };

        // Space Mission Data
        const spaceMissions = {
            basic: {
                name: 'Planeta B√°sico',
                icon: 'ü™ê',
                difficulty: 'F√°cil',
                crystals: 50,
                problems: 5,
                timeLimit: 60,
                operations: ['add', 'subtract'],
                maxDenominator: 8
            },
            advanced: {
                name: 'Estrella Dorada',
                icon: 'üåü',
                difficulty: 'Media',
                crystals: 100,
                problems: 7,
                timeLimit: 90,
                operations: ['add', 'subtract', 'multiply'],
                maxDenominator: 12
            },
            master: {
                name: 'Agujero Negro',
                icon: 'üåå',
                difficulty: 'Experto',
                crystals: 200,
                problems: 10,
                timeLimit: 120,
                operations: ['add', 'subtract', 'multiply', 'divide'],
                maxDenominator: 20
            }
        };

        // Tutorial Content - Expandido y Detallado
        const lessonContents = {
            basics: {
                title: "Conceptos B√°sicos de Fracciones",
                xp: 50,
                content: `
                    <h3 class="text-3xl font-bold mb-8 text-blue-600 text-center">üìö ¬°Bienvenido al Mundo de las Fracciones!</h3>
                    
                    <div class="space-y-8">
                        <!-- Introducci√≥n -->
                        <div class="bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-blue-700 dark:text-blue-300 flex items-center">
                                <span class="text-3xl mr-3">üß†</span> ¬øQu√© es una fracci√≥n?
                            </h4>
                            <p class="text-lg mb-6 leading-relaxed">
                                Una <strong>fracci√≥n</strong> es como un trozo de pizza o un pedazo de chocolate. 
                                Representa <em>una parte de algo completo</em> que ha sido dividido en partes iguales.
                            </p>
                            
                            <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl mb-6">
                                <div class="text-center mb-6">
                                    <div class="fraction text-6xl mb-4">
                                        <span class="numerator text-red-600 font-bold">3</span>
                                        <span class="denominator text-blue-600 font-bold">4</span>
                                    </div>
                                    <p class="text-xl font-semibold text-gray-700 dark:text-gray-300">Se lee: "tres cuartos"</p>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="text-center p-6 bg-red-50 dark:bg-red-900/20 rounded-xl border-2 border-red-200 dark:border-red-800">
                                        <div class="text-4xl font-bold text-red-600 mb-3">3</div>
                                        <h5 class="text-lg font-bold text-red-700 dark:text-red-300 mb-2">NUMERADOR</h5>
                                        <p class="text-sm">Indica <strong>cu√°ntas partes</strong> hemos tomado o consideramos</p>
                                        <p class="text-xs mt-2 text-red-600">¬°Va arriba de la l√≠nea!</p>
                                    </div>
                                    <div class="text-center p-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl border-2 border-blue-200 dark:border-blue-800">
                                        <div class="text-4xl font-bold text-blue-600 mb-3">4</div>
                                        <h5 class="text-lg font-bold text-blue-700 dark:text-blue-300 mb-2">DENOMINADOR</h5>
                                        <p class="text-sm">Indica <strong>en cu√°ntas partes iguales</strong> se dividi√≥ el todo</p>
                                        <p class="text-xs mt-2 text-blue-600">¬°Va abajo de la l√≠nea!</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl">
                                <p class="text-center text-lg"><strong>üí° Recuerda:</strong> El denominador nunca puede ser cero (¬°no puedes dividir en 0 partes!)</p>
                            </div>
                        </div>
                        
                        <!-- Visualizaci√≥n Pr√°ctica -->
                        <div class="bg-gradient-to-r from-green-100 to-teal-100 dark:from-green-900/30 dark:to-teal-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-green-700 dark:text-green-300 flex items-center">
                                <span class="text-3xl mr-3">üéØ</span> Visualizando 3/4
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold">üç´ Ejemplo con Chocolate:</h5>
                                    <div class="flex justify-center mb-4">
                                        <div class="grid grid-cols-4 gap-1">
                                            <div class="w-12 h-12 bg-amber-600 rounded border-2 border-amber-800 flex items-center justify-center text-white font-bold">‚úì</div>
                                            <div class="w-12 h-12 bg-amber-600 rounded border-2 border-amber-800 flex items-center justify-center text-white font-bold">‚úì</div>
                                            <div class="w-12 h-12 bg-amber-600 rounded border-2 border-amber-800 flex items-center justify-center text-white font-bold">‚úì</div>
                                            <div class="w-12 h-12 bg-gray-300 rounded border-2 border-gray-500 flex items-center justify-center text-gray-600">‚úó</div>
                                        </div>
                                    </div>
                                    <p class="text-sm text-center">
                                        <strong>3 de 4 cuadros</strong> est√°n coloreados<br>
                                        Esto representa <strong>3/4</strong> del chocolate
                                    </p>
                                </div>
                                
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold">üìä Como porcentaje:</h5>
                                    <div class="bg-white/70 dark:bg-gray-800/70 p-4 rounded-xl">
                                        <div class="text-center mb-3">
                                            <span class="text-3xl font-bold text-green-600">75%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-6">
                                            <div class="bg-green-500 h-6 rounded-full" style="width: 75%"></div>
                                        </div>
                                        <p class="text-sm text-center mt-2">3/4 = 0.75 = 75%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tipos de Fracciones -->
                        <div class="bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-purple-700 dark:text-purple-300 flex items-center">
                                <span class="text-3xl mr-3">üîç</span> Los 3 Tipos de Fracciones
                            </h4>
                            
                            <div class="grid lg:grid-cols-3 gap-6">
                                <!-- Fracci√≥n Propia -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">‚úÖ</span>
                                        <h5 class="text-xl font-bold text-green-600 mt-2">PROPIA</h5>
                                    </div>
                                    
                                    <div class="text-center mb-4">
                                        <div class="fraction text-3xl mb-2">
                                            <span class="numerator">2</span>
                                            <span class="denominator">5</span>
                                        </div>
                                        <p class="text-sm font-bold">Numerador &lt; Denominador</p>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <p class="text-sm"><strong>Caracter√≠sticas:</strong></p>
                                        <ul class="text-xs space-y-1 list-disc list-inside">
                                            <li>Menor que 1 entero</li>
                                            <li>Como decimal: 0.4</li>
                                            <li>Como porcentaje: 40%</li>
                                        </ul>
                                        
                                        <div class="flex justify-center mt-3">
                                            <div class="flex gap-1">
                                                <div class="w-6 h-6 bg-green-500 rounded"></div>
                                                <div class="w-6 h-6 bg-green-500 rounded"></div>
                                                <div class="w-6 h-6 bg-gray-300 rounded"></div>
                                                <div class="w-6 h-6 bg-gray-300 rounded"></div>
                                                <div class="w-6 h-6 bg-gray-300 rounded"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-green-50 dark:bg-green-900/20 p-2 rounded text-xs">
                                            <strong>Ejemplos:</strong> 1/2, 3/8, 5/9
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Fracci√≥n Impropia -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-orange-500">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">üî•</span>
                                        <h5 class="text-xl font-bold text-orange-600 mt-2">IMPROPIA</h5>
                                    </div>
                                    
                                    <div class="text-center mb-4">
                                        <div class="fraction text-3xl mb-2">
                                            <span class="numerator">7</span>
                                            <span class="denominator">3</span>
                                        </div>
                                        <p class="text-sm font-bold">Numerador ‚â• Denominador</p>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <p class="text-sm"><strong>Caracter√≠sticas:</strong></p>
                                        <ul class="text-xs space-y-1 list-disc list-inside">
                                            <li>Mayor o igual a 1 entero</li>
                                            <li>Como decimal: 2.33...</li>
                                            <li>Como porcentaje: 233%</li>
                                        </ul>
                                        
                                        <div class="space-y-2">
                                            <p class="text-xs font-bold">Visualizaci√≥n:</p>
                                            <div class="flex gap-1 justify-center">
                                                <div class="w-6 h-6 bg-orange-500 rounded"></div>
                                                <div class="w-6 h-6 bg-orange-500 rounded"></div>
                                                <div class="w-6 h-6 bg-orange-500 rounded"></div>
                                            </div>
                                            <div class="flex gap-1 justify-center">
                                                <div class="w-6 h-6 bg-orange-500 rounded"></div>
                                                <div class="w-6 h-6 bg-gray-300 rounded"></div>
                                                <div class="w-6 h-6 bg-gray-300 rounded"></div>
                                            </div>
                                            <p class="text-xs text-center">2 enteros + 1/3</p>
                                        </div>
                                        
                                        <div class="bg-orange-50 dark:bg-orange-900/20 p-2 rounded text-xs">
                                            <strong>Ejemplos:</strong> 5/4, 8/3, 10/7
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Fracci√≥n Mixta -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">üéØ</span>
                                        <h5 class="text-xl font-bold text-purple-600 mt-2">MIXTA</h5>
                                    </div>
                                    
                                    <div class="text-center mb-4">
                                        <div class="text-3xl mb-2">
                                            2 <span class="fraction">
                                                <span class="numerator">1</span>
                                                <span class="denominator">3</span>
                                            </span>
                                        </div>
                                        <p class="text-sm font-bold">Entero + Fracci√≥n Propia</p>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <p class="text-sm"><strong>Caracter√≠sticas:</strong></p>
                                        <ul class="text-xs space-y-1 list-disc list-inside">
                                            <li>Parte entera + fracci√≥n</li>
                                            <li>Forma de escribir impropias</li>
                                            <li>M√°s f√°cil de entender</li>
                                        </ul>
                                        
                                        <div class="bg-purple-50 dark:bg-purple-900/20 p-3 rounded">
                                            <p class="text-xs font-bold mb-2">Conversi√≥n:</p>
                                            <div class="text-center">
                                                <p class="text-sm">7/3 = 2 1/3</p>
                                                <p class="text-xs text-purple-600">7 √∑ 3 = 2 resto 1</p>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-purple-50 dark:bg-purple-900/20 p-2 rounded text-xs">
                                            <strong>Ejemplos:</strong> 1 1/2, 3 2/5, 5 3/8
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ejemplos de la Vida Real -->
                        <div class="bg-gradient-to-r from-yellow-100 to-orange-100 dark:from-yellow-900/30 dark:to-orange-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-yellow-700 dark:text-yellow-300 flex items-center">
                                <span class="text-3xl mr-3">üåü</span> Fracciones en tu Vida Diaria
                            </h4>
                            
                            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <!-- Pizza -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">üçï</span>
                                        <h5 class="text-lg font-bold text-orange-600 mt-2">Pizza</h5>
                                    </div>
                                    <div class="text-center mb-3">
                                        <div class="fraction text-2xl">
                                            <span class="numerator text-red-600">3</span>
                                            <span class="denominator text-blue-600">8</span>
                                        </div>
                                    </div>
                                    <p class="text-sm text-center">Pizza cortada en 8 pedazos, comiste 3</p>
                                    <div class="mt-3 p-2 bg-orange-50 dark:bg-orange-900/20 rounded text-xs">
                                        <strong>Significa:</strong> 37.5% de la pizza
                                    </div>
                                </div>
                                
                                <!-- Tiempo -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">‚è∞</span>
                                        <h5 class="text-lg font-bold text-blue-600 mt-2">Tiempo</h5>
                                    </div>
                                    <div class="text-center mb-3">
                                        <div class="fraction text-2xl">
                                            <span class="numerator text-red-600">1</span>
                                            <span class="denominator text-blue-600">4</span>
                                        </div>
                                    </div>
                                    <p class="text-sm text-center">Un cuarto de hora = 15 minutos</p>
                                    <div class="mt-3 p-2 bg-blue-50 dark:bg-blue-900/20 rounded text-xs">
                                        <strong>Tambi√©n:</strong> 1/2 hora = 30 min
                                    </div>
                                </div>
                                
                                <!-- Dinero -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">üí∞</span>
                                        <h5 class="text-lg font-bold text-green-600 mt-2">Dinero</h5>
                                    </div>
                                    <div class="text-center mb-3">
                                        <div class="fraction text-2xl">
                                            <span class="numerator text-red-600">1</span>
                                            <span class="denominator text-blue-600">2</span>
                                        </div>
                                    </div>
                                    <p class="text-sm text-center">La mitad de $100 = $50</p>
                                    <div class="mt-3 p-2 bg-green-50 dark:bg-green-900/20 rounded text-xs">
                                        <strong>Tambi√©n:</strong> 1/4 = $25
                                    </div>
                                </div>
                                
                                <!-- Calificaciones -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">üìä</span>
                                        <h5 class="text-lg font-bold text-purple-600 mt-2">Ex√°menes</h5>
                                    </div>
                                    <div class="text-center mb-3">
                                        <div class="fraction text-2xl">
                                            <span class="numerator text-red-600">9</span>
                                            <span class="denominator text-blue-600">10</span>
                                        </div>
                                    </div>
                                    <p class="text-sm text-center">9 de 10 respuestas correctas</p>
                                    <div class="mt-3 p-2 bg-purple-50 dark:bg-purple-900/20 rounded text-xs">
                                        <strong>Nota:</strong> 90% = Excelente
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ejercicio Interactivo -->
                        <div class="bg-gradient-to-r from-red-100 to-pink-100 dark:from-red-900/30 dark:to-pink-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-red-700 dark:text-red-300 flex items-center">
                                <span class="text-3xl mr-3">üéÆ</span> ¬°Practica lo que Aprendiste!
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold">Identifica las partes de esta fracci√≥n:</h5>
                                    <div class="text-center mb-4">
                                        <div class="fraction text-6xl">
                                            <span class="numerator text-red-600 font-bold">5</span>
                                            <span class="denominator text-blue-600 font-bold">6</span>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="p-4 bg-white dark:bg-gray-800 rounded-lg text-center border-2 border-red-200">
                                            <p class="font-bold text-red-600 text-lg">Numerador: 5</p>
                                            <p class="text-sm mt-2">¬øQu√© significa?</p>
                                            <p class="text-xs mt-2 text-gray-600">Tomamos 5 partes</p>
                                        </div>
                                        <div class="p-4 bg-white dark:bg-gray-800 rounded-lg text-center border-2 border-blue-200">
                                            <p class="font-bold text-blue-600 text-lg">Denominador: 6</p>
                                            <p class="text-sm mt-2">¬øQu√© significa?</p>
                                            <p class="text-xs mt-2 text-gray-600">El todo se dividi√≥ en 6 partes</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold">Visualizaci√≥n:</h5>
                                    <div class="flex justify-center">
                                        <div class="grid grid-cols-3 gap-1">
                                            <div class="w-12 h-12 bg-red-500 rounded border-2 border-red-700 flex items-center justify-center text-white font-bold">1</div>
                                            <div class="w-12 h-12 bg-red-500 rounded border-2 border-red-700 flex items-center justify-center text-white font-bold">2</div>
                                            <div class="w-12 h-12 bg-red-500 rounded border-2 border-red-700 flex items-center justify-center text-white font-bold">3</div>
                                            <div class="w-12 h-12 bg-red-500 rounded border-2 border-red-700 flex items-center justify-center text-white font-bold">4</div>
                                            <div class="w-12 h-12 bg-red-500 rounded border-2 border-red-700 flex items-center justify-center text-white font-bold">5</div>
                                            <div class="w-12 h-12 bg-gray-300 rounded border-2 border-gray-500 flex items-center justify-center text-gray-600 font-bold">6</div>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-sm font-bold">5/6 = 83.33%</p>
                                        <p class="text-xs text-gray-600">¬°Casi el total completo!</p>
                                    </div>
                                    
                                    <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl">
                                        <p class="text-sm font-bold text-center mb-2">üí° ¬øSab√≠as que...?</p>
                                        <p class="text-xs text-center">5/6 es una fracci√≥n propia porque 5 < 6</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Resumen Final -->
                        <div class="bg-gradient-to-r from-indigo-100 to-cyan-100 dark:from-indigo-900/30 dark:to-cyan-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-indigo-700 dark:text-indigo-300 flex items-center">
                                <span class="text-3xl mr-3">üìù</span> Resumen de lo que Aprendiste
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold">‚úÖ Conceptos Clave:</h5>
                                    <ul class="space-y-2 text-sm">
                                        <li class="flex items-start"><span class="text-green-500 mr-2">‚ñ∂</span>Fracci√≥n = Parte de un todo</li>
                                        <li class="flex items-start"><span class="text-green-500 mr-2">‚ñ∂</span>Numerador (arriba) = Partes tomadas</li>
                                        <li class="flex items-start"><span class="text-green-500 mr-2">‚ñ∂</span>Denominador (abajo) = Total de partes</li>
                                        <li class="flex items-start"><span class="text-green-500 mr-2">‚ñ∂</span>Denominador nunca puede ser 0</li>
                                    </ul>
                                </div>
                                
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold">üéØ Tipos que Conoces:</h5>
                                    <ul class="space-y-2 text-sm">
                                        <li class="flex items-start"><span class="text-blue-500 mr-2">‚ñ∂</span><strong>Propia:</strong> Numerador < Denominador (menor que 1)</li>
                                        <li class="flex items-start"><span class="text-orange-500 mr-2">‚ñ∂</span><strong>Impropia:</strong> Numerador ‚â• Denominador (mayor que 1)</li>
                                        <li class="flex items-start"><span class="text-purple-500 mr-2">‚ñ∂</span><strong>Mixta:</strong> Entero + Fracci√≥n propia</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="mt-6 p-4 bg-white/70 dark:bg-gray-800/70 rounded-xl text-center">
                                <p class="text-lg font-bold text-indigo-600">üéâ ¬°Felicidades!</p>
                                <p class="text-sm">Ya tienes las bases para entender las fracciones. ¬°Ahora puedes avanzar a las operaciones!</p>
                            </div>
                        </div>
                    </div>
                `
            },
            addition: {
                title: "Suma y Resta de Fracciones",
                xp: 75,
                content: `
                    <h3 class="text-3xl font-bold mb-8 text-yellow-600 text-center">‚ûï‚ûñ Dominando Suma y Resta de Fracciones</h3>
                    
                    <div class="space-y-8">
                        <!-- Introducci√≥n -->
                        <div class="bg-gradient-to-r from-yellow-100 to-orange-100 dark:from-yellow-900/30 dark:to-orange-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-yellow-700 dark:text-yellow-300 flex items-center">
                                <span class="text-3xl mr-3">üéØ</span> ¬øQu√© aprender√°s en esta lecci√≥n?
                            </h4>
                            
                            <p class="text-lg mb-6 leading-relaxed">
                                Sumar y restar fracciones es como combinar o quitar partes de pizzas, pasteles o cualquier cosa dividida en pedazos. 
                                Existen <strong>dos situaciones principales</strong> que debes dominar:
                            </p>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">‚úÖ</span>
                                        <h5 class="text-xl font-bold text-green-600 mt-2">Caso F√°cil</h5>
                                    </div>
                                    <p class="text-sm mb-3"><strong>Mismo denominador</strong></p>
                                    <p class="text-xs">Cuando las fracciones tienen el mismo "fondo", solo sumas o restas los numeradores.</p>
                                    <div class="text-center mt-3">
                                        <span class="fraction text-lg">
                                            <span class="numerator">2</span>
                                            <span class="denominator">7</span>
                                        </span>
                                        <span class="mx-2">+</span>
                                        <span class="fraction text-lg">
                                            <span class="numerator">3</span>
                                            <span class="denominator">7</span>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">ü¶ã</span>
                                        <h5 class="text-xl font-bold text-purple-600 mt-2">M√©todo Mariposa</h5>
                                    </div>
                                    <p class="text-sm mb-3"><strong>Denominadores diferentes</strong></p>
                                    <p class="text-xs">Usamos multiplicaciones cruzadas para encontrar un denominador com√∫n.</p>
                                    <div class="text-center mt-3">
                                        <span class="fraction text-lg">
                                            <span class="numerator">1</span>
                                            <span class="denominator">2</span>
                                        </span>
                                        <span class="mx-2">+</span>
                                        <span class="fraction text-lg">
                                            <span class="numerator">1</span>
                                            <span class="denominator">3</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Caso 1: Denominadores Iguales -->
                        <div class="bg-gradient-to-r from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-green-700 dark:text-green-300 flex items-center">
                                <span class="text-3xl mr-3">‚úÖ</span> Caso 1: Denominadores Iguales
                            </h4>
                            
                            <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl mb-6">
                                <h5 class="text-xl font-bold mb-4 text-green-600 text-center">üìú La Regla de Oro</h5>
                                <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-xl text-center">
                                    <p class="text-lg font-bold">Cuando los denominadores son iguales:</p>
                                    <p class="text-base mt-2">1Ô∏è‚É£ <strong>Mant√©n</strong> el denominador igual</p>
                                    <p class="text-base">2Ô∏è‚É£ <strong>Suma o resta</strong> solo los numeradores</p>
                                    <p class="text-base">3Ô∏è‚É£ <strong>Simplifica</strong> el resultado si es posible</p>
                                </div>
                            </div>
                            
                            <!-- Suma con denominadores iguales -->
                            <div class="grid lg:grid-cols-2 gap-8">
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-xl font-bold mb-4 text-green-600 flex items-center">
                                        <span class="text-2xl mr-2">‚ûï</span> SUMA
                                    </h5>
                                    
                                    <div class="space-y-4">
                                        <div class="text-center">
                                            <div class="text-3xl mb-4">
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">7</span>
                                                </span>
                                                <span class="mx-3">+</span>
                                                <span class="fraction">
                                                    <span class="numerator">3</span>
                                                    <span class="denominator">7</span>
                                                </span>
                                                <span class="mx-3">=</span>
                                                <span class="fraction">
                                                    <span class="numerator text-green-600">5</span>
                                                    <span class="denominator">7</span>
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-xl">
                                            <p class="text-sm font-bold mb-2">üìù Paso a paso:</p>
                                            <ol class="text-sm space-y-1 list-decimal list-inside">
                                                <li>Los denominadores son iguales (7 y 7) ‚úì</li>
                                                <li>Mant√©n el denominador: <strong>7</strong></li>
                                                <li>Suma numeradores: 2 + 3 = <strong>5</strong></li>
                                                <li>Resultado: <strong>5/7</strong></li>
                                            </ol>
                                        </div>
                                        
                                        <!-- Visualizaci√≥n -->
                                        <div class="space-y-3">
                                            <p class="text-sm font-bold">üé® Visualizaci√≥n:</p>
                                            <div class="text-center space-y-2">
                                                <div class="flex justify-center gap-1">
                                                    <div class="text-xs">2/7:</div>
                                                    <div class="w-4 h-4 bg-blue-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-blue-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                </div>
                                                <div class="text-lg">+</div>
                                                <div class="flex justify-center gap-1">
                                                    <div class="text-xs">3/7:</div>
                                                    <div class="w-4 h-4 bg-green-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-green-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-green-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                </div>
                                                <div class="text-lg">=</div>
                                                <div class="flex justify-center gap-1">
                                                    <div class="text-xs">5/7:</div>
                                                    <div class="w-4 h-4 bg-yellow-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-yellow-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-yellow-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-yellow-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-yellow-500 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                    <div class="w-4 h-4 bg-gray-300 rounded-sm"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Resta con denominadores iguales -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-xl font-bold mb-4 text-red-600 flex items-center">
                                        <span class="text-2xl mr-2">‚ûñ</span> RESTA
                                    </h5>
                                    
                                    <div class="space-y-4">
                                        <div class="text-center">
                                            <div class="text-3xl mb-4">
                                                <span class="fraction">
                                                    <span class="numerator">5</span>
                                                    <span class="denominator">9</span>
                                                </span>
                                                <span class="mx-3">-</span>
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">9</span>
                                                </span>
                                                <span class="mx-3">=</span>
                                                <span class="fraction">
                                                    <span class="numerator text-red-600">3</span>
                                                    <span class="denominator">9</span>
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-xl">
                                            <p class="text-sm font-bold mb-2">üìù Paso a paso:</p>
                                            <ol class="text-sm space-y-1 list-decimal list-inside">
                                                <li>Los denominadores son iguales (9 y 9) ‚úì</li>
                                                <li>Mant√©n el denominador: <strong>9</strong></li>
                                                <li>Resta numeradores: 5 - 2 = <strong>3</strong></li>
                                                <li>Resultado: <strong>3/9 = 1/3</strong> (simplificado)</li>
                                            </ol>
                                        </div>
                                        
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-xl">
                                            <p class="text-sm font-bold">üí° Tip importante:</p>
                                            <p class="text-xs">Siempre verifica si puedes simplificar el resultado. 3/9 = 1/3 porque 3 y 9 se pueden dividir entre 3.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- M√°s ejemplos -->
                            <div class="mt-6 bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                <h5 class="text-lg font-bold mb-4">üî¢ M√°s ejemplos para practicar:</h5>
                                <div class="grid md:grid-cols-3 gap-4">
                                    <div class="text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                        <div class="text-lg mb-2">
                                            <span class="fraction"><span class="numerator">1</span><span class="denominator">4</span></span>
                                            +
                                            <span class="fraction"><span class="numerator">2</span><span class="denominator">4</span></span>
                                            =
                                            <span class="fraction"><span class="numerator text-green-600">3</span><span class="denominator">4</span></span>
                                        </div>
                                        <p class="text-xs">1 + 2 = 3</p>
                                    </div>
                                    <div class="text-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                        <div class="text-lg mb-2">
                                            <span class="fraction"><span class="numerator">7</span><span class="denominator">8</span></span>
                                            -
                                            <span class="fraction"><span class="numerator">3</span><span class="denominator">8</span></span>
                                            =
                                            <span class="fraction"><span class="numerator text-red-600">4</span><span class="denominator">8</span></span>
                                        </div>
                                        <p class="text-xs">7 - 3 = 4 = 1/2</p>
                                    </div>
                                    <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                        <div class="text-lg mb-2">
                                            <span class="fraction"><span class="numerator">3</span><span class="denominator">5</span></span>
                                            +
                                            <span class="fraction"><span class="numerator">1</span><span class="denominator">5</span></span>
                                            =
                                            <span class="fraction"><span class="numerator text-blue-600">4</span><span class="denominator">5</span></span>
                                        </div>
                                        <p class="text-xs">3 + 1 = 4</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Caso 2: M√©todo Mariposa -->
                        <div class="bg-gradient-to-r from-purple-100 to-indigo-100 dark:from-purple-900/30 dark:to-indigo-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-purple-700 dark:text-purple-300 flex items-center">
                                <span class="text-3xl mr-3">ü¶ã</span> Caso 2: M√©todo Mariposa
                            </h4>
                            
                            <p class="text-lg mb-6">
                                Cuando las fracciones tienen <strong>denominadores diferentes</strong>, necesitamos encontrar un denominador com√∫n. 
                                El m√©todo mariposa es una t√©cnica visual s√∫per f√°cil para resolverlo.
                            </p>
                            
                            <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl mb-6">
                                <h5 class="text-xl font-bold mb-4 text-center text-purple-600">üéØ Ejemplo Principal: 1/2 + 1/3</h5>
                                
                                <div class="grid lg:grid-cols-2 gap-8">
                                    <!-- Explicaci√≥n paso a paso -->
                                    <div class="space-y-4">
                                        <div class="text-center text-2xl mb-4">
                                            <span class="fraction">
                                                <span class="numerator text-red-600">1</span>
                                                <span class="denominator text-blue-600">2</span>
                                            </span>
                                            <span class="mx-3">+</span>
                                            <span class="fraction">
                                                <span class="numerator text-red-600">1</span>
                                                <span class="denominator text-blue-600">3</span>
                                            </span>
                                        </div>
                                        
                                        <div class="space-y-3">
                                            <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl">
                                                <p class="text-sm font-bold mb-2">ü¶ã Paso 1: Multiplicaciones cruzadas</p>
                                                <ul class="text-sm space-y-1">
                                                    <li>‚Ä¢ Numerador 1 √ó Denominador 2: <strong>1 √ó 3 = 3</strong></li>
                                                    <li>‚Ä¢ Numerador 2 √ó Denominador 1: <strong>1 √ó 2 = 2</strong></li>
                                                    <li>‚Ä¢ Suma los resultados: <strong>3 + 2 = 5</strong></li>
                                                </ul>
                                            </div>
                                            
                                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl">
                                                <p class="text-sm font-bold mb-2">üìê Paso 2: Multiplicar denominadores</p>
                                                <p class="text-sm">‚Ä¢ Denominador 1 √ó Denominador 2: <strong>2 √ó 3 = 6</strong></p>
                                            </div>
                                            
                                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-xl">
                                                <p class="text-sm font-bold mb-2">‚úÖ Resultado final:</p>
                                                <div class="text-center text-2xl">
                                                    <span class="fraction">
                                                        <span class="numerator text-green-600">5</span>
                                                        <span class="denominator text-green-600">6</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Diagrama visual de mariposa -->
                                    <div class="text-center">
                                        <h6 class="text-lg font-bold mb-4">ü¶ã Diagrama Mariposa:</h6>
                                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                            <div class="relative">
                                                <!-- Fracciones originales -->
                                                <div class="flex justify-between items-center mb-8">
                                                    <div class="text-center">
                                                        <div class="fraction text-2xl">
                                                            <span class="numerator text-red-600 font-bold">1</span>
                                                            <span class="denominator text-blue-600 font-bold">2</span>
                                                        </div>
                                                    </div>
                                                    <div class="text-2xl">+</div>
                                                    <div class="text-center">
                                                        <div class="fraction text-2xl">
                                                            <span class="numerator text-red-600 font-bold">1</span>
                                                            <span class="denominator text-blue-600 font-bold">3</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Multiplicaciones cruzadas visuales -->
                                                <div class="mb-6">
                                                    <div class="flex justify-center gap-8 mb-2">
                                                        <span class="bg-yellow-200 px-2 py-1 rounded text-sm font-bold">1√ó3=3</span>
                                                        <span class="bg-yellow-200 px-2 py-1 rounded text-sm font-bold">1√ó2=2</span>
                                                    </div>
                                                    <div class="text-center">
                                                        <span class="bg-orange-200 px-3 py-2 rounded text-lg font-bold">3+2=5</span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Denominador final -->
                                                <div class="text-center mb-4">
                                                    <span class="bg-blue-200 px-3 py-2 rounded text-lg font-bold">2√ó3=6</span>
                                                </div>
                                                
                                                <!-- Resultado -->
                                                <div class="text-center">
                                                    <div class="fraction text-3xl">
                                                        <span class="numerator text-green-600 font-bold">5</span>
                                                        <span class="denominator text-green-600 font-bold">6</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- F√≥rmula general -->
                            <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl mb-6">
                                <h5 class="text-lg font-bold mb-4 text-center">üìú F√≥rmula General del M√©todo Mariposa</h5>
                                <div class="text-center text-2xl mb-4">
                                    <span class="fraction">
                                        <span class="numerator text-red-600">a</span>
                                        <span class="denominator text-blue-600">b</span>
                                    </span>
                                    <span class="mx-3">¬±</span>
                                    <span class="fraction">
                                        <span class="numerator text-red-600">c</span>
                                        <span class="denominator text-blue-600">d</span>
                                    </span>
                                    <span class="mx-3">=</span>
                                    <span class="fraction">
                                        <span class="numerator text-green-600">(a√ód) ¬± (c√ób)</span>
                                        <span class="denominator text-purple-600">b√ód</span>
                                    </span>
                                </div>
                                <p class="text-sm text-center text-gray-600">donde ¬± puede ser + (suma) o - (resta)</p>
                            </div>
                        </div>
                        
                        <!-- Ejemplos Adicionales -->
                        <div class="bg-gradient-to-r from-orange-100 to-red-100 dark:from-orange-900/30 dark:to-red-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-orange-700 dark:text-orange-300 flex items-center">
                                <span class="text-3xl mr-3">üí°</span> M√°s Ejemplos para Dominar la T√©cnica
                            </h4>
                            
                            <div class="grid lg:grid-cols-2 gap-8">
                                <!-- Ejemplo de suma -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-blue-600">‚ûï Suma con m√©todo mariposa:</h5>
                                    <div class="text-center text-xl mb-4">
                                        <span class="fraction">
                                            <span class="numerator">2</span>
                                            <span class="denominator">5</span>
                                        </span>
                                        <span class="mx-2">+</span>
                                        <span class="fraction">
                                            <span class="numerator">1</span>
                                            <span class="denominator">3</span>
                                        </span>
                                    </div>
                                    <div class="space-y-2 text-sm">
                                        <p><strong>ü¶ã Multiplicaciones cruzadas:</strong></p>
                                        <p>‚Ä¢ (2√ó3) + (1√ó5) = 6 + 5 = <strong>11</strong></p>
                                        <p><strong>üìê Denominador final:</strong></p>
                                        <p>‚Ä¢ 5 √ó 3 = <strong>15</strong></p>
                                        <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-xl mt-3">
                                            <p class="text-center font-bold text-green-600">
                                                Resultado: <span class="fraction text-lg">
                                                    <span class="numerator">11</span>
                                                    <span class="denominator">15</span>
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ejemplo de resta -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-red-600">‚ûñ Resta con m√©todo mariposa:</h5>
                                    <div class="text-center text-xl mb-4">
                                        <span class="fraction">
                                            <span class="numerator">3</span>
                                            <span class="denominator">4</span>
                                        </span>
                                        <span class="mx-2">-</span>
                                        <span class="fraction">
                                            <span class="numerator">1</span>
                                            <span class="denominator">6</span>
                                        </span>
                                    </div>
                                    <div class="space-y-2 text-sm">
                                        <p><strong>ü¶ã Multiplicaciones cruzadas:</strong></p>
                                        <p>‚Ä¢ (3√ó6) - (1√ó4) = 18 - 4 = <strong>14</strong></p>
                                        <p><strong>üìê Denominador final:</strong></p>
                                        <p>‚Ä¢ 4 √ó 6 = <strong>24</strong></p>
                                        <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-xl mt-3">
                                            <p class="text-center font-bold text-green-600">
                                                Resultado: <span class="fraction text-lg">
                                                    <span class="numerator">14</span>
                                                    <span class="denominator">24</span>
                                                </span> = <span class="fraction text-lg">
                                                    <span class="numerator">7</span>
                                                    <span class="denominator">12</span>
                                                </span>
                                            </p>
                                            <p class="text-xs text-center mt-1">(simplificado dividiendo entre 2)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ejercicios de Pr√°ctica -->
                        <div class="bg-gradient-to-r from-cyan-100 to-blue-100 dark:from-cyan-900/30 dark:to-blue-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-cyan-700 dark:text-cyan-300 flex items-center">
                                <span class="text-3xl mr-3">üéÆ</span> ¬°Hora de Practicar!
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- Ejercicios denominadores iguales -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-green-600">‚úÖ Denominadores Iguales</h5>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm mb-2"><strong>Ejercicio 1:</strong></p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">3</span>
                                                    <span class="denominator">8</span>
                                                </span>
                                                <span class="mx-2">+</span>
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">8</span>
                                                </span>
                                                <span class="mx-2">=</span>
                                                <span class="text-green-600">?</span>
                                            </div>
                                            <p class="text-xs text-center mt-2 text-gray-500">Respuesta: 5/8</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm mb-2"><strong>Ejercicio 2:</strong></p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">7</span>
                                                    <span class="denominator">10</span>
                                                </span>
                                                <span class="mx-2">-</span>
                                                <span class="fraction">
                                                    <span class="numerator">3</span>
                                                    <span class="denominator">10</span>
                                                </span>
                                                <span class="mx-2">=</span>
                                                <span class="text-green-600">?</span>
                                            </div>
                                            <p class="text-xs text-center mt-2 text-gray-500">Respuesta: 4/10 = 2/5</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ejercicios m√©todo mariposa -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-purple-600">ü¶ã M√©todo Mariposa</h5>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm mb-2"><strong>Ejercicio 3:</strong></p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                <span class="mx-2">+</span>
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">6</span>
                                                </span>
                                                <span class="mx-2">=</span>
                                                <span class="text-purple-600">?</span>
                                            </div>
                                            <p class="text-xs mt-2">ü¶ã (1√ó6)+(1√ó4) = 6+4 = 10</p>
                                            <p class="text-xs">üìê 4√ó6 = 24</p>
                                            <p class="text-xs text-center text-gray-500">Respuesta: 10/24 = 5/12</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm mb-2"><strong>Ejercicio 4:</strong></p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">3</span>
                                                </span>
                                                <span class="mx-2">-</span>
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">5</span>
                                                </span>
                                                <span class="mx-2">=</span>
                                                <span class="text-purple-600">?</span>
                                            </div>
                                            <p class="text-xs mt-2">ü¶ã (2√ó5)-(1√ó3) = 10-3 = 7</p>
                                            <p class="text-xs">üìê 3√ó5 = 15</p>
                                            <p class="text-xs text-center text-gray-500">Respuesta: 7/15</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Consejos y Errores Comunes -->
                        <div class="bg-gradient-to-r from-red-100 to-pink-100 dark:from-red-900/30 dark:to-pink-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-red-700 dark:text-red-300 flex items-center">
                                <span class="text-3xl mr-3">‚ö†Ô∏è</span> Errores Comunes y C√≥mo Evitarlos
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold text-red-600">‚ùå Errores Frecuentes:</h5>
                                    <div class="space-y-3">
                                        <div class="bg-red-50 dark:bg-red-900/20 p-3 rounded-lg">
                                            <p class="text-sm font-bold">1. Sumar denominadores</p>
                                            <p class="text-xs">‚ùå 1/2 + 1/3 = 2/5 (¬°Incorrecto!)</p>
                                            <p class="text-xs">‚úÖ 1/2 + 1/3 = 5/6 (Correcto)</p>
                                        </div>
                                        <div class="bg-red-50 dark:bg-red-900/20 p-3 rounded-lg">
                                            <p class="text-sm font-bold">2. Olvidar simplificar</p>
                                            <p class="text-xs">‚ùå Dejar 6/8 sin simplificar</p>
                                            <p class="text-xs">‚úÖ Simplificar a 3/4</p>
                                        </div>
                                        <div class="bg-red-50 dark:bg-red-900/20 p-3 rounded-lg">
                                            <p class="text-sm font-bold">3. Cambiar denominadores iguales</p>
                                            <p class="text-xs">‚ùå Usar mariposa cuando no es necesario</p>
                                            <p class="text-xs">‚úÖ Si son iguales, solo suma/resta numeradores</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold text-green-600">‚úÖ Consejos para el √âxito:</h5>
                                    <div class="space-y-3">
                                        <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg">
                                            <p class="text-sm font-bold">1. Verifica denominadores primero</p>
                                            <p class="text-xs">Si son iguales ‚Üí m√©todo f√°cil</p>
                                            <p class="text-xs">Si son diferentes ‚Üí m√©todo mariposa</p>
                                        </div>
                                        <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg">
                                            <p class="text-sm font-bold">2. Siempre simplifica el resultado</p>
                                            <p class="text-xs">Busca factores comunes en numerador y denominador</p>
                                        </div>
                                        <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg">
                                            <p class="text-sm font-bold">3. Dibuja si te ayuda</p>
                                            <p class="text-xs">Visualizar fracciones puede aclarar el problema</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Resumen Final -->
                        <div class="bg-gradient-to-r from-indigo-100 to-purple-100 dark:from-indigo-900/30 dark:to-purple-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-indigo-700 dark:text-indigo-300 flex items-center">
                                <span class="text-3xl mr-3">üéØ</span> Resumen: Suma y Resta de Fracciones
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-green-600">üìã M√©todo por Casos:</h5>
                                    <div class="space-y-3 text-sm">
                                        <div class="flex items-start">
                                            <span class="text-green-500 mr-2 mt-1">‚úÖ</span>
                                            <div>
                                                <strong>Denominadores iguales:</strong>
                                                <p>Mant√©n denominador, opera numeradores</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start">
                                            <span class="text-purple-500 mr-2 mt-1">ü¶ã</span>
                                            <div>
                                                <strong>Denominadores diferentes:</strong>
                                                <p>Usa m√©todo mariposa (multiplicaciones cruzadas)</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start">
                                            <span class="text-blue-500 mr-2 mt-1">üîß</span>
                                            <div>
                                                <strong>Siempre al final:</strong>
                                                <p>Simplifica el resultado si es posible</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-purple-600">üß† Recuerda:</h5>
                                    <div class="space-y-3 text-sm">
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-lg">
                                            <p class="font-bold">F√≥rmula Mariposa:</p>
                                            <div class="text-center text-lg mt-2">
                                                <span class="fraction">
                                                    <span class="numerator">a</span>
                                                    <span class="denominator">b</span>
                                                </span>
                                                ¬±
                                                <span class="fraction">
                                                    <span class="numerator">c</span>
                                                    <span class="denominator">d</span>
                                                </span>
                                                =
                                                <span class="fraction">
                                                    <span class="numerator">(a√ód)¬±(c√ób)</span>
                                                    <span class="denominator">b√ód</span>
                                                </span>
                                            </div>
                                        </div>
                                        <p class="text-center text-lg font-bold text-indigo-600">üéâ ¬°Ya dominas suma y resta!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            multiply: {
                title: "Multiplicaci√≥n y Divisi√≥n de Fracciones",
                xp: 100,
                content: `
                    <h3 class="text-3xl font-bold mb-8 text-purple-600 text-center">‚úñÔ∏è‚ûó Maestro de Multiplicaci√≥n y Divisi√≥n</h3>
                    
                    <div class="space-y-8">
                        <!-- Introducci√≥n -->
                        <div class="bg-gradient-to-r from-purple-100 to-indigo-100 dark:from-purple-900/30 dark:to-indigo-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-purple-700 dark:text-purple-300 flex items-center">
                                <span class="text-3xl mr-3">üöÄ</span> ¬°Las Operaciones M√°s F√°ciles!
                            </h4>
                            
                            <p class="text-lg mb-6 leading-relaxed">
                                ¬øSab√≠as que multiplicar y dividir fracciones es <strong>m√°s f√°cil</strong> que sumarlas y restarlas? 
                                No necesitas denominadores comunes ni complicadas mariposas. ¬°Solo aplicas reglas directas!
                            </p>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">‚úñÔ∏è</span>
                                        <h5 class="text-xl font-bold text-green-600 mt-2">Multiplicaci√≥n</h5>
                                    </div>
                                    <p class="text-sm mb-3"><strong>S√∫per simple:</strong></p>
                                    <p class="text-xs mb-3">Multiplica numeradores entre s√≠ y denominadores entre s√≠.</p>
                                    <div class="text-center">
                                        <div class="text-lg">
                                            <span class="fraction">
                                                <span class="numerator text-red-600">a</span>
                                                <span class="denominator text-blue-600">b</span>
                                            </span>
                                            √ó
                                            <span class="fraction">
                                                <span class="numerator text-red-600">c</span>
                                                <span class="denominator text-blue-600">d</span>
                                            </span>
                                            =
                                            <span class="fraction">
                                                <span class="numerator text-green-600">a√óc</span>
                                                <span class="denominator text-purple-600">b√ód</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                    <div class="text-center mb-4">
                                        <span class="text-4xl">‚ûó</span>
                                        <h5 class="text-xl font-bold text-cyan-600 mt-2">Divisi√≥n</h5>
                                    </div>
                                    <p class="text-sm mb-3"><strong>Truco m√°gico:</strong></p>
                                    <p class="text-xs mb-3">"Invertir y multiplicar" - dale la vuelta a la segunda fracci√≥n y multiplica.</p>
                                    <div class="text-center">
                                        <div class="text-lg">
                                            <span class="fraction">
                                                <span class="numerator text-red-600">a</span>
                                                <span class="denominator text-blue-600">b</span>
                                            </span>
                                            √∑
                                            <span class="fraction">
                                                <span class="numerator text-red-600">c</span>
                                                <span class="denominator text-blue-600">d</span>
                                            </span>
                                            =
                                            <span class="fraction">
                                                <span class="numerator text-red-600">a</span>
                                                <span class="denominator text-blue-600">b</span>
                                            </span>
                                            √ó
                                            <span class="fraction">
                                                <span class="numerator text-blue-600">d</span>
                                                <span class="denominator text-red-600">c</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Multiplicaci√≥n Detallada -->
                        <div class="bg-gradient-to-r from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-green-700 dark:text-green-300 flex items-center">
                                <span class="text-3xl mr-3">‚úñÔ∏è</span> Multiplicaci√≥n - ¬°La M√°s F√°cil!
                            </h4>
                            
                            <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl mb-6">
                                <h5 class="text-xl font-bold mb-4 text-center text-green-600">üéØ Regla de Oro</h5>
                                <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-xl">
                                    <div class="text-center text-2xl mb-4">
                                        <span class="fraction">
                                            <span class="numerator text-red-600">a</span>
                                            <span class="denominator text-blue-600">b</span>
                                        </span>
                                        √ó
                                        <span class="fraction">
                                            <span class="numerator text-red-600">c</span>
                                            <span class="denominator text-blue-600">d</span>
                                        </span>
                                        =
                                        <span class="fraction">
                                            <span class="numerator text-green-600">a √ó c</span>
                                            <span class="denominator text-purple-600">b √ó d</span>
                                        </span>
                                    </div>
                                    <div class="text-center space-y-2">
                                        <p class="text-sm">1Ô∏è‚É£ <strong>Multiplica</strong> numeradores: a √ó c</p>
                                        <p class="text-sm">2Ô∏è‚É£ <strong>Multiplica</strong> denominadores: b √ó d</p>
                                        <p class="text-sm">3Ô∏è‚É£ <strong>Simplifica</strong> el resultado si es posible</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ejemplo Paso a Paso -->
                            <div class="grid lg:grid-cols-2 gap-8">
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-green-600">üìä Ejemplo Detallado</h5>
                                    
                                    <div class="space-y-4">
                                        <div class="text-center text-3xl mb-4">
                                            <span class="fraction">
                                                <span class="numerator">2</span>
                                                <span class="denominator">3</span>
                                            </span>
                                            √ó
                                            <span class="fraction">
                                                <span class="numerator">4</span>
                                                <span class="denominator">5</span>
                                            </span>
                                        </div>
                                        
                                        <div class="space-y-3">
                                            <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl">
                                                <p class="text-sm font-bold">Paso 1: Multiplica numeradores</p>
                                                <p class="text-sm">2 √ó 4 = <strong class="text-green-600">8</strong></p>
                                            </div>
                                            
                                            <div class="bg-purple-50 dark:bg-purple-900/20 p-3 rounded-xl">
                                                <p class="text-sm font-bold">Paso 2: Multiplica denominadores</p>
                                                <p class="text-sm">3 √ó 5 = <strong class="text-purple-600">15</strong></p>
                                            </div>
                                            
                                            <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-xl">
                                                <p class="text-sm font-bold">Paso 3: Resultado</p>
                                                <div class="text-center text-2xl">
                                                    <span class="fraction">
                                                        <span class="numerator text-green-600">8</span>
                                                        <span class="denominator text-purple-600">15</span>
                                                    </span>
                                                </div>
                                                <p class="text-xs text-center mt-2">(Ya est√° simplificado)</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Significado Visual -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-blue-600">üé® ¬øQu√© significa multiplicar fracciones?</h5>
                                    
                                    <div class="space-y-4">
                                        <div class="text-center">
                                            <p class="text-sm font-bold mb-2">2/3 √ó 4/5 significa:</p>
                                            <p class="text-xs">"2/3 de 4/5" o "4/5 de 2/3"</p>
                                        </div>
                                        
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl">
                                            <p class="text-xs font-bold mb-2">üç∞ Ejemplo con pastel:</p>
                                            <ul class="text-xs space-y-1">
                                                <li>‚Ä¢ Tienes 4/5 de un pastel</li>
                                                <li>‚Ä¢ Comes 2/3 de esa porci√≥n</li>
                                                <li>‚Ä¢ Has comido 8/15 del pastel total</li>
                                            </ul>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-xl">
                                            <p class="text-xs font-bold mb-2">üìè Como decimal:</p>
                                            <p class="text-xs">8/15 ‚âà 0.533... ‚âà 53.3%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Truco Pro: Simplificar Antes -->
                            <div class="mt-6 bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                <h5 class="text-lg font-bold mb-4 text-yellow-600">üí° Truco Pro: Simplificar Antes de Multiplicar</h5>
                                
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <h6 class="font-bold mb-3">‚ùå M√©todo Largo:</h6>
                                        <div class="space-y-2 text-sm">
                                            <div class="text-center">
                                                <span class="fraction">
                                                    <span class="numerator">6</span>
                                                    <span class="denominator">8</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator">4</span>
                                                    <span class="denominator">9</span>
                                                </span>
                                                =
                                                <span class="fraction">
                                                    <span class="numerator">24</span>
                                                    <span class="denominator">72</span>
                                                </span>
                                            </div>
                                            <p class="text-center">Luego simplificar: 24/72 = 1/3</p>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h6 class="font-bold mb-3">‚úÖ M√©todo Inteligente:</h6>
                                        <div class="space-y-2 text-sm">
                                            <div class="text-center">
                                                <span class="fraction">
                                                    <span class="numerator"><s>6</s> 2</span>
                                                    <span class="denominator">8</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator">4</span>
                                                    <span class="denominator"><s>9</s> 3</span>
                                                </span>
                                                =
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">6</span>
                                                </span>
                                                =
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">3</span>
                                                </span>
                                            </div>
                                            <p class="text-center text-xs">Cancelar antes: 6√∑3=2, 9√∑3=3</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Divisi√≥n Detallada -->
                        <div class="bg-gradient-to-r from-cyan-100 to-blue-100 dark:from-cyan-900/30 dark:to-blue-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-cyan-700 dark:text-cyan-300 flex items-center">
                                <span class="text-3xl mr-3">‚ûó</span> Divisi√≥n - Invertir y Multiplicar
                            </h4>
                            
                            <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl mb-6">
                                <h5 class="text-xl font-bold mb-4 text-center text-cyan-600">üé≤ Los 4 Pasos M√°gicos</h5>
                                
                                <div class="grid md:grid-cols-4 gap-4">
                                    <div class="text-center p-3 bg-cyan-50 dark:bg-cyan-900/20 rounded-xl">
                                        <div class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mx-auto mb-2">1</div>
                                        <p class="text-sm font-bold">Mant√©n</p>
                                        <p class="text-xs">la primera fracci√≥n</p>
                                    </div>
                                    <div class="text-center p-3 bg-cyan-50 dark:bg-cyan-900/20 rounded-xl">
                                        <div class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mx-auto mb-2">2</div>
                                        <p class="text-sm font-bold">Cambia</p>
                                        <p class="text-xs">√∑ por √ó</p>
                                    </div>
                                    <div class="text-center p-3 bg-cyan-50 dark:bg-cyan-900/20 rounded-xl">
                                        <div class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mx-auto mb-2">3</div>
                                        <p class="text-sm font-bold">Invierte</p>
                                        <p class="text-xs">la segunda fracci√≥n</p>
                                    </div>
                                    <div class="text-center p-3 bg-cyan-50 dark:bg-cyan-900/20 rounded-xl">
                                        <div class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mx-auto mb-2">4</div>
                                        <p class="text-sm font-bold">Multiplica</p>
                                        <p class="text-xs">normalmente</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ejemplo Principal -->
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl mb-6">
                                <h5 class="text-lg font-bold mb-4 text-center text-cyan-600">üéØ Ejemplo Paso a Paso: 3/4 √∑ 2/5</h5>
                                
                                <div class="grid lg:grid-cols-2 gap-8">
                                    <div class="space-y-4">
                                        <div class="text-center">
                                            <p class="text-sm mb-2 font-bold">Problema Original:</p>
                                            <div class="text-3xl">
                                                <span class="fraction">
                                                    <span class="numerator">3</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                √∑
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">5</span>
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="text-center">
                                            <p class="text-sm mb-2 font-bold">Despu√©s de Invertir:</p>
                                            <div class="text-3xl">
                                                <span class="fraction">
                                                    <span class="numerator">3</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator text-green-600">5</span>
                                                    <span class="denominator text-green-600">2</span>
                                                </span>
                                            </div>
                                            <p class="text-xs text-green-600 mt-1">2/5 se invierte a 5/2</p>
                                        </div>
                                        
                                        <div class="text-center">
                                            <p class="text-sm mb-2 font-bold">Resultado Final:</p>
                                            <div class="text-3xl font-bold text-blue-600">
                                                <span class="fraction">
                                                    <span class="numerator">15</span>
                                                    <span class="denominator">8</span>
                                                </span>
                                            </div>
                                            <p class="text-xs mt-1">3√ó5=15, 4√ó2=8</p>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-4">
                                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl">
                                            <p class="text-sm font-bold mb-2">üîç An√°lisis del Resultado:</p>
                                            <ul class="text-xs space-y-1">
                                                <li>‚Ä¢ 15/8 es una fracci√≥n impropia</li>
                                                <li>‚Ä¢ Como n√∫mero mixto: 1 7/8</li>
                                                <li>‚Ä¢ Como decimal: 1.875</li>
                                                <li>‚Ä¢ Como porcentaje: 187.5%</li>
                                            </ul>
                                        </div>
                                        
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl">
                                            <p class="text-sm font-bold mb-2">ü§î ¬øQu√© significa dividir fracciones?</p>
                                            <p class="text-xs">3/4 √∑ 2/5 pregunta: "¬øCu√°ntas veces cabe 2/5 en 3/4?"</p>
                                            <p class="text-xs mt-2">Respuesta: 1.875 veces (casi 2 veces)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- M√°s Ejemplos -->
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-indigo-600">Ejemplo 2:</h5>
                                    <div class="space-y-3">
                                        <div class="text-center text-xl">
                                            <span class="fraction">
                                                <span class="numerator">1</span>
                                                <span class="denominator">2</span>
                                            </span>
                                            √∑
                                            <span class="fraction">
                                                <span class="numerator">1</span>
                                                <span class="denominator">4</span>
                                            </span>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded text-sm">
                                            <p><strong>Invertir:</strong> 1/4 ‚Üí 4/1</p>
                                            <p><strong>Multiplicar:</strong> 1/2 √ó 4/1</p>
                                            <p><strong>Resultado:</strong> 4/2 = <strong class="text-green-600">2</strong></p>
                                        </div>
                                        
                                        <div class="bg-blue-50 dark:bg-blue-900/20 p-2 rounded text-xs">
                                            <strong>Interpretaci√≥n:</strong> En 1/2 caben exactamente 2 pedazos de 1/4
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-pink-600">Ejemplo 3:</h5>
                                    <div class="space-y-3">
                                        <div class="text-center text-xl">
                                            <span class="fraction">
                                                <span class="numerator">6</span>
                                                <span class="denominator">7</span>
                                            </span>
                                            √∑
                                            <span class="fraction">
                                                <span class="numerator">3</span>
                                                <span class="denominator">14</span>
                                            </span>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded text-sm">
                                            <p><strong>Invertir:</strong> 3/14 ‚Üí 14/3</p>
                                            <p><strong>Multiplicar:</strong> 6/7 √ó 14/3</p>
                                            <p><strong>Calcular:</strong> (6√ó14)/(7√ó3) = 84/21</p>
                                            <p><strong>Simplificar:</strong> <strong class="text-green-600">4</strong></p>
                                        </div>
                                        
                                        <div class="bg-pink-50 dark:bg-pink-900/20 p-2 rounded text-xs">
                                            <strong>Tip:</strong> 84√∑21=4 porque ambos son m√∫ltiplos de 21
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Casos Especiales -->
                        <div class="bg-gradient-to-r from-orange-100 to-yellow-100 dark:from-orange-900/30 dark:to-yellow-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-orange-700 dark:text-orange-300 flex items-center">
                                <span class="text-3xl mr-3">‚≠ê</span> Casos Especiales y Trucos
                            </h4>
                            
                            <div class="grid lg:grid-cols-3 gap-6">
                                <!-- Multiplicar por entero -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-blue-600">üî¢ Multiplicar por un Entero</h5>
                                    <div class="space-y-3">
                                        <div class="text-center text-lg">
                                            <span class="fraction">
                                                <span class="numerator">2</span>
                                                <span class="denominator">3</span>
                                            </span>
                                            √ó 5
                                        </div>
                                        
                                        <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded text-sm">
                                            <p><strong>Convierte el entero:</strong> 5 = 5/1</p>
                                            <p><strong>Multiplica:</strong> 2/3 √ó 5/1 = 10/3</p>
                                            <p><strong>Como mixto:</strong> 3 1/3</p>
                                        </div>
                                        
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded text-xs">
                                            <strong>Atajo:</strong> Solo multiplica el numerador por el entero
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Dividir entre entero -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-green-600">‚ûó Dividir entre un Entero</h5>
                                    <div class="space-y-3">
                                        <div class="text-center text-lg">
                                            <span class="fraction">
                                                <span class="numerator">3</span>
                                                <span class="denominator">4</span>
                                            </span>
                                            √∑ 2
                                        </div>
                                        
                                        <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded text-sm">
                                            <p><strong>Convierte el entero:</strong> 2 = 2/1</p>
                                            <p><strong>Invierte:</strong> 2/1 ‚Üí 1/2</p>
                                            <p><strong>Multiplica:</strong> 3/4 √ó 1/2 = 3/8</p>
                                        </div>
                                        
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded text-xs">
                                            <strong>Atajo:</strong> Solo multiplica el denominador por el entero
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Fracciones complejas -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-purple-600">üèóÔ∏è Fracciones Complejas</h5>
                                    <div class="space-y-3">
                                        <div class="text-center text-lg">
                                            <div class="fraction" style="font-size: 0.8em;">
                                                <div class="numerator" style="border-bottom: 3px solid #333;">
                                                    <span class="fraction" style="font-size: 0.7em;">
                                                        <span class="numerator">1</span>
                                                        <span class="denominator">2</span>
                                                    </span>
                                                </div>
                                                <div class="denominator">
                                                    <span class="fraction" style="font-size: 0.7em;">
                                                        <span class="numerator">3</span>
                                                        <span class="denominator">4</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-purple-50 dark:bg-purple-900/20 p-3 rounded text-sm">
                                            <p><strong>Significa:</strong> (1/2) √∑ (3/4)</p>
                                            <p><strong>Resolve:</strong> 1/2 √ó 4/3 = 4/6 = 2/3</p>
                                        </div>
                                        
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded text-xs">
                                            <strong>Regla:</strong> La l√≠nea grande significa divisi√≥n
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Aplicaciones Pr√°cticas -->
                        <div class="bg-gradient-to-r from-teal-100 to-cyan-100 dark:from-teal-900/30 dark:to-cyan-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-teal-700 dark:text-teal-300 flex items-center">
                                <span class="text-3xl mr-3">üåç</span> Aplicaciones en la Vida Real
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold text-blue-600">‚úñÔ∏è Multiplicaci√≥n en Acci√≥n:</h5>
                                    <div class="space-y-3">
                                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl">
                                            <p class="text-sm font-bold mb-2">üç∞ Cocina:</p>
                                            <p class="text-xs mb-2">Una receta pide 2/3 de taza de az√∫car para 4 personas. Para 6 personas necesitas:</p>
                                            <div class="text-center">
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">3</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator">6</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                = 1 taza
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl">
                                            <p class="text-sm font-bold mb-2">üé® Arte:</p>
                                            <p class="text-xs mb-2">Reduces un dibujo a 3/4 de su tama√±o original, luego a 2/3 de eso:</p>
                                            <div class="text-center">
                                                <span class="fraction">
                                                    <span class="numerator">3</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">3</span>
                                                </span>
                                                = 
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">2</span>
                                                </span>
                                                del tama√±o original
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <h5 class="text-lg font-bold text-red-600">‚ûó Divisi√≥n en Acci√≥n:</h5>
                                    <div class="space-y-3">
                                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl">
                                            <p class="text-sm font-bold mb-2">üçï Compartir Comida:</p>
                                            <p class="text-xs mb-2">Tienes 3/4 de pizza y quieres repartirla entre 3 amigos por igual:</p>
                                            <div class="text-center">
                                                <span class="fraction">
                                                    <span class="numerator">3</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                √∑ 3 = 
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                para cada uno
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl">
                                            <p class="text-sm font-bold mb-2">üöó Viajes:</p>
                                            <p class="text-xs mb-2">Tu auto recorre 1/4 de milla con 1/8 de gal√≥n. ¬øMillas por gal√≥n?</p>
                                            <div class="text-center">
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                √∑
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">8</span>
                                                </span>
                                                = 2 millas/gal√≥n
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ejercicios de Pr√°ctica -->
                        <div class="bg-gradient-to-r from-pink-100 to-red-100 dark:from-pink-900/30 dark:to-red-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-pink-700 dark:text-pink-300 flex items-center">
                                <span class="text-3xl mr-3">üéÆ</span> ¬°Ejercicios para Ser un Experto!
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- Ejercicios de Multiplicaci√≥n -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-green-600">‚úñÔ∏è Multiplicaci√≥n</h5>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm font-bold mb-2">Ejercicio 1:</p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">3</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">5</span>
                                                </span>
                                                = ?
                                            </div>
                                            <p class="text-xs text-center mt-2 text-gray-500">Respuesta: 2/15</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm font-bold mb-2">Ejercicio 2:</p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">4</span>
                                                    <span class="denominator">9</span>
                                                </span>
                                                √ó 3 = ?
                                            </div>
                                            <p class="text-xs text-center mt-2 text-gray-500">Respuesta: 12/9 = 4/3 = 1 1/3</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm font-bold mb-2">Ejercicio 3 (con simplificaci√≥n):</p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">6</span>
                                                    <span class="denominator">8</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator">4</span>
                                                    <span class="denominator">3</span>
                                                </span>
                                                = ?
                                            </div>
                                            <p class="text-xs mt-2">Simplifica primero: 6/8 √ó 4/3 = (3√ó4)/(4√ó3) = 1</p>
                                            <p class="text-xs text-center text-gray-500">Respuesta: 1</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ejercicios de Divisi√≥n -->
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-cyan-600">‚ûó Divisi√≥n</h5>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm font-bold mb-2">Ejercicio 4:</p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">2</span>
                                                    <span class="denominator">3</span>
                                                </span>
                                                √∑
                                                <span class="fraction">
                                                    <span class="numerator">1</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                = ?
                                            </div>
                                            <p class="text-xs mt-2">Invierte: 1/4 ‚Üí 4/1, luego 2/3 √ó 4/1</p>
                                            <p class="text-xs text-center text-gray-500">Respuesta: 8/3 = 2 2/3</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm font-bold mb-2">Ejercicio 5:</p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">5</span>
                                                    <span class="denominator">6</span>
                                                </span>
                                                √∑ 2 = ?
                                            </div>
                                            <p class="text-xs mt-2">Divide entre entero: 5/6 √∑ 2/1 = 5/6 √ó 1/2</p>
                                            <p class="text-xs text-center text-gray-500">Respuesta: 5/12</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <p class="text-sm font-bold mb-2">Ejercicio 6:</p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">7</span>
                                                    <span class="denominator">8</span>
                                                </span>
                                                √∑
                                                <span class="fraction">
                                                    <span class="numerator">3</span>
                                                    <span class="denominator">4</span>
                                                </span>
                                                = ?
                                            </div>
                                            <p class="text-xs mt-2">7/8 √ó 4/3 = 28/24 = 7/6</p>
                                            <p class="text-xs text-center text-gray-500">Respuesta: 7/6 = 1 1/6</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Resumen Final -->
                        <div class="bg-gradient-to-r from-indigo-100 to-purple-100 dark:from-indigo-900/30 dark:to-purple-900/30 p-8 rounded-2xl">
                            <h4 class="text-2xl font-bold mb-6 text-indigo-700 dark:text-indigo-300 flex items-center">
                                <span class="text-3xl mr-3">üéØ</span> Resumen Completo
                            </h4>
                            
                            <div class="grid lg:grid-cols-2 gap-8">
                                <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-green-600">‚úñÔ∏è Multiplicaci√≥n</h5>
                                    <div class="space-y-3">
                                        <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-xl">
                                            <p class="text-sm font-bold mb-2">F√≥rmula:</p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">a</span>
                                                    <span class="denominator">b</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator">c</span>
                                                    <span class="denominator">d</span>
                                                </span>
                                                =
                                                <span class="fraction">
                                                    <span class="numerator">a√óc</span>
                                                    <span class="denominator">b√ód</span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="text-sm space-y-1">
                                            <p>‚úÖ Multiplica numeradores</p>
                                            <p>‚úÖ Multiplica denominadores</p>
                                            <p>‚úÖ Simplifica el resultado</p>
                                            <p>üí° <strong>Tip:</strong> Puedes simplificar antes</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl">
                                    <h5 class="text-lg font-bold mb-4 text-cyan-600">‚ûó Divisi√≥n</h5>
                                    <div class="space-y-3">
                                        <div class="bg-cyan-50 dark:bg-cyan-900/20 p-3 rounded-xl">
                                            <p class="text-sm font-bold mb-2">F√≥rmula:</p>
                                            <div class="text-center text-lg">
                                                <span class="fraction">
                                                    <span class="numerator">a</span>
                                                    <span class="denominator">b</span>
                                                </span>
                                                √∑
                                                <span class="fraction">
                                                    <span class="numerator">c</span>
                                                    <span class="denominator">d</span>
                                                </span>
                                                =
                                                <span class="fraction">
                                                    <span class="numerator">a</span>
                                                    <span class="denominator">b</span>
                                                </span>
                                                √ó
                                                <span class="fraction">
                                                    <span class="numerator">d</span>
                                                    <span class="denominator">c</span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="text-sm space-y-1">
                                            <p>1Ô∏è‚É£ Mant√©n la primera fracci√≥n</p>
                                            <p>2Ô∏è‚É£ Cambia √∑ por √ó</p>
                                            <p>3Ô∏è‚É£ Invierte la segunda fracci√≥n</p>
                                            <p>4Ô∏è‚É£ Multiplica normalmente</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 bg-white/70 dark:bg-gray-800/70 p-6 rounded-xl text-center">
                                <p class="text-xl font-bold text-purple-600 mb-2">üéâ ¬°Felicidades!</p>
                                <p class="text-lg">Ya dominas todas las operaciones con fracciones</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Suma, resta, multiplicaci√≥n y divisi√≥n - ¬°Las tienes todas!</p>
                                <div class="mt-4 flex justify-center gap-4 text-2xl">
                                    <span>üèÜ</span>
                                    <span>‚≠ê</span>
                                    <span>üéØ</span>
                                    <span>üöÄ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            }
        };

        // Initialize game
        function initGame() {
            updateUI();
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.className = 'nav-btn bg-gray-300 dark:bg-gray-600 px-6 py-3 rounded-2xl hover:bg-gray-400 dark:hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 shadow-lg';
            });
            
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Reset practice section if going to practice
            if (sectionId === 'practice') {
                resetPracticeSection();
            }
            
            if (event && event.target) {
                event.target.className = 'nav-btn bg-gradient-to-r from-blue-500 to-cyan-600 text-white px-6 py-3 rounded-2xl hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 transform hover:scale-105 shadow-lg';
            }
        }

        // Tutorial System
        function showLessonDetail(lessonType) {
            const lesson = lessonContents[lessonType];
            if (!lesson) return;
            
            document.getElementById('lesson-selection').classList.add('hidden');
            document.getElementById('lesson-detail').classList.remove('hidden');
            
            document.getElementById('lesson-content-display').innerHTML = lesson.content;
            gameState.currentLesson = lessonType;
            
            const completeBtn = document.getElementById('complete-lesson-btn');
            completeBtn.innerHTML = `Completar Lecci√≥n (+${lesson.xp} XP) ‚ú®`;
        }

        function backToLessons() {
            document.getElementById('lesson-selection').classList.remove('hidden');
            document.getElementById('lesson-detail').classList.add('hidden');
            gameState.currentLesson = null;
        }

        function completeLessonDirect() {
            if (!gameState.currentLesson) return;
            
            const lesson = lessonContents[gameState.currentLesson];
            addXP(lesson.xp);
            addPoints(lesson.xp * 2);
            
            showNotification(`üéì ¬°Lecci√≥n completada! +${lesson.xp} XP`, 'success');
            createConfetti();
            
            backToLessons();
        }

        // Space Adventure System
        function startSpaceMission(missionType) {
            const mission = spaceMissions[missionType];
            if (!mission) return;

            gameState.currentMission = missionType;
            gameState.missionProgress = 0;
            gameState.missionScore = 0;
            gameState.missionTime = mission.timeLimit;

            document.getElementById('mission-selection').classList.add('hidden');
            document.getElementById('mission-interface').classList.remove('hidden');
            
            document.getElementById('mission-title').innerHTML = `${mission.icon} ${mission.name}`;
            
            // Start mission timer
            gameState.missionTimer = setInterval(() => {
                gameState.missionTime--;
                document.getElementById('mission-time').textContent = gameState.missionTime;
                
                if (gameState.missionTime <= 0) {
                    endMission();
                }
            }, 1000);

            generateSpaceProblem();
            updateMissionUI();
        }

        function generateSpaceProblem() {
            const mission = spaceMissions[gameState.currentMission];
            const operations = mission.operations;
            const operation = operations[Math.floor(Math.random() * operations.length)];
            
            const maxDen = mission.maxDenominator;
            let num1 = Math.floor(Math.random() * (maxDen - 1)) + 1;
            let den1 = Math.floor(Math.random() * maxDen) + 2;
            let num2 = Math.floor(Math.random() * (maxDen - 1)) + 1;
            let den2 = Math.floor(Math.random() * maxDen) + 2;

            let correctAnswer, symbol;
            
            switch(operation) {
                case 'add':
                    correctAnswer = simplifyFraction((num1 * den2) + (num2 * den1), den1 * den2);
                    symbol = '+';
                    break;
                case 'subtract':
                    if (num1 * den2 >= num2 * den1) {
                        correctAnswer = simplifyFraction((num1 * den2) - (num2 * den1), den1 * den2);
                    } else {
                        correctAnswer = simplifyFraction((num2 * den1) - (num1 * den2), den1 * den2);
                        [num1, den1, num2, den2] = [num2, den2, num1, den1];
                    }
                    symbol = '-';
                    break;
                case 'multiply':
                    correctAnswer = simplifyFraction(num1 * num2, den1 * den2);
                    symbol = '√ó';
                    break;
                case 'divide':
                    correctAnswer = simplifyFraction(num1 * den2, den1 * num2);
                    symbol = '√∑';
                    break;
            }

            gameState.currentProblem = { num1, den1, num2, den2, operation, correctAnswer, symbol };

            document.getElementById('problem-display').innerHTML = `
                <div class="space-y-4">
                    <p class="text-lg">¬°Tu nave necesita calcular la trayectoria!</p>
                    <div class="text-4xl">
                        <span class="fraction">
                            <span class="numerator">${num1}</span>
                            <span class="denominator">${den1}</span>
                        </span>
                        <span class="mx-4">${symbol}</span>
                        <span class="fraction">
                            <span class="numerator">${num2}</span>
                            <span class="denominator">${den2}</span>
                        </span>
                        <span class="mx-4">=</span>
                        <span class="text-yellow-400">?</span>
                    </div>
                </div>
            `;

            generateSpaceOptions(correctAnswer);
        }

        function generateSpaceOptions(correctAnswer) {
            const options = [correctAnswer];
            
            // Generate wrong answers
            while (options.length < 4) {
                const wrongNum = Math.max(1, correctAnswer[0] + Math.floor(Math.random() * 6) - 3);
                const wrongDen = Math.max(1, correctAnswer[1] + Math.floor(Math.random() * 6) - 3);
                
                const wrong = [wrongNum, wrongDen];
                if (!options.some(opt => opt[0] === wrong[0] && opt[1] === wrong[1])) {
                    options.push(wrong);
                }
            }

            // Shuffle options
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }

            const optionsHtml = options.map((option, index) => `
                <button onclick="checkSpaceAnswer(${option[0]}, ${option[1]})" 
                        class="space-option bg-gradient-to-r from-cyan-400 to-blue-500 text-white p-4 rounded-xl hover:from-cyan-500 hover:to-blue-600 transition-all transform hover:scale-105 shadow-lg text-xl">
                    <span class="fraction">
                        <span class="numerator">${option[0]}</span>
                        <span class="denominator">${option[1]}</span>
                    </span>
                </button>
            `).join('');

            document.getElementById('space-options').innerHTML = optionsHtml;
        }

        function checkSpaceAnswer(selectedNum, selectedDen) {
            if (!gameState.currentProblem) return;

            const correct = gameState.currentProblem.correctAnswer;
            const isCorrect = selectedNum === correct[0] && selectedDen === correct[1];

            // Disable all buttons
            document.querySelectorAll('.space-option').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('pointer-events-none');
                
                const fractionText = btn.querySelector('.fraction');
                const num = parseInt(fractionText.querySelector('.numerator').textContent);
                const den = parseInt(fractionText.querySelector('.denominator').textContent);
                
                if (num === selectedNum && den === selectedDen) {
                    if (isCorrect) {
                        btn.classList.remove('from-cyan-400', 'to-blue-500');
                        btn.classList.add('from-green-500', 'to-emerald-600', 'animate-pop');
                    } else {
                        btn.classList.remove('from-cyan-400', 'to-blue-500');
                        btn.classList.add('from-red-500', 'to-red-600');
                    }
                } else if (num === correct[0] && den === correct[1] && !isCorrect) {
                    btn.classList.remove('from-cyan-400', 'to-blue-500');
                    btn.classList.add('from-green-500', 'to-emerald-600');
                }
            });

            if (isCorrect) {
                gameState.missionProgress++;
                gameState.missionScore += 100;
                createMiniConfetti();
                
                setTimeout(() => {
                    const mission = spaceMissions[gameState.currentMission];
                    if (gameState.missionProgress >= mission.problems) {
                        endMission();
                    } else {
                        generateSpaceProblem();
                    }
                }, 1500);
            } else {
                setTimeout(() => {
                    generateSpaceProblem();
                }, 2000);
            }

            updateMissionUI();
        }

        function updateMissionUI() {
            const mission = spaceMissions[gameState.currentMission];
            document.getElementById('mission-progress').textContent = `${gameState.missionProgress}/${mission.problems}`;
            document.getElementById('mission-score').textContent = gameState.missionScore;
            document.getElementById('mission-time').textContent = gameState.missionTime;
        }

        function endMission() {
            if (gameState.missionTimer) {
                clearInterval(gameState.missionTimer);
                gameState.missionTimer = null;
            }

            const mission = spaceMissions[gameState.currentMission];
            const completionRate = gameState.missionProgress / mission.problems;
            const crystalsEarned = Math.floor(mission.crystals * completionRate);
            const xpEarned = Math.floor(crystalsEarned / 2);

            gameState.spaceMissions++;
            gameState.crystals += crystalsEarned;
            addXP(xpEarned);
            addPoints(crystalsEarned);

            document.getElementById('space-problem').classList.add('hidden');
            document.getElementById('mission-results').classList.remove('hidden');
            
            document.getElementById('mission-summary').innerHTML = `
                <div class="space-y-2">
                    <p><strong>Problemas resueltos:</strong> ${gameState.missionProgress}/${mission.problems}</p>
                    <p><strong>Puntuaci√≥n:</strong> ${gameState.missionScore}</p>
                    <p><strong>Cristales ganados:</strong> +${crystalsEarned} üíé</p>
                    <p><strong>XP ganado:</strong> +${xpEarned} ‚≠ê</p>
                    <div class="text-2xl mt-4">
                        ${completionRate >= 0.8 ? 'üåü ¬°Excelente trabajo!' : 
                          completionRate >= 0.6 ? 'üëç ¬°Buen trabajo!' : 
                          'üí™ ¬°Sigue practicando!'}
                    </div>
                </div>
            `;

            showNotification(`üöÄ Misi√≥n completada: +${crystalsEarned} cristales!`, 'success');
            createConfetti();
        }

        function exitMission() {
            if (gameState.missionTimer) {
                clearInterval(gameState.missionTimer);
                gameState.missionTimer = null;
            }
            returnToMissions();
        }

        function returnToMissions() {
            document.getElementById('mission-selection').classList.remove('hidden');
            document.getElementById('mission-interface').classList.add('hidden');
            document.getElementById('space-problem').classList.remove('hidden');
            document.getElementById('mission-results').classList.add('hidden');
            
            gameState.currentMission = null;
            gameState.missionProgress = 0;
            gameState.missionScore = 0;
        }

        // Utility Functions
        function addXP(amount) {
            gameState.xp += amount;
            
            const xpNeeded = gameState.level * 100;
            if (gameState.xp >= xpNeeded) {
                levelUp();
            }
            
            updateUI();
            showXPGain(amount);
        }

        function levelUp() {
            gameState.level++;
            gameState.xp = 0;
            
            createConfetti();
            showNotification(`üéâ ¬°Nivel ${gameState.level}! ¬°Incre√≠ble progreso!`, 'success');
        }

        function addPoints(amount) {
            gameState.totalPoints += amount;
            updateUI();
        }

        function simplifyFraction(num, den) {
            const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
            const divisor = gcd(Math.abs(num), Math.abs(den));
            return [num / divisor, den / divisor];
        }

        function createConfetti() {
            const container = document.getElementById('confetti-container');
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57'];
            
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function createMiniConfetti() {
            const container = document.getElementById('confetti-container');
            const colors = ['#4ade80', '#22c55e', '#16a34a'];
            
            for (let i = 0; i < 15; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                container.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 2000);
            }
        }

        function showXPGain(amount) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-2 rounded-xl shadow-lg z-50 animate-pop';
            notification.textContent = `+${amount} XP`;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 2000);
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgClass = type === 'success' ? 'from-green-500 to-emerald-500' : 'from-blue-500 to-purple-500';
            
            notification.className = `fixed top-4 right-4 bg-gradient-to-r ${bgClass} text-white px-6 py-3 rounded-xl shadow-lg z-50 animate-pop max-w-sm`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        }

        function updateUI() {
            document.getElementById('player-level').textContent = gameState.level;
            document.getElementById('current-xp').textContent = gameState.xp;
            document.getElementById('max-xp').textContent = gameState.level * 100;
            document.getElementById('total-points').textContent = gameState.totalPoints;
            document.getElementById('streak-count').textContent = gameState.streak;
            document.getElementById('achievement-count').textContent = gameState.achievements.length;
            document.getElementById('space-missions').textContent = gameState.spaceMissions;
            document.getElementById('crystals-collected').textContent = gameState.crystals;
            document.getElementById('current-galaxy').textContent = `Galaxia ${gameState.currentGalaxy}`;
            document.getElementById('ship-level').textContent = `Nave Nivel ${gameState.shipLevel}`;
            document.getElementById('energy-level').textContent = `${gameState.energy}%`;
            
            const xpPercentage = (gameState.xp / (gameState.level * 100)) * 100;
            document.getElementById('xp-bar').style.width = xpPercentage + '%';
        }

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }

        // Challenge System
        let challengeState = {
            currentProblem: 0,
            score: 0,
            correct: 0,
            streak: 0,
            timer: null,
            timeLeft: 60,
            problems: [],
            started: false
        };

        // Challenge Problems (5 mixed operations)
        const challengeProblems = [
            {
                display: '(1/2 √ó 3/4) + 1/6',
                equation: '(1/2 √ó 3/4) + 1/6',
                solution: [7, 12], // 3/8 + 1/6 = 9/24 + 4/24 = 13/24... wait let me recalculate
                hint: 'Primero resuelve la multiplicaci√≥n (1/2 √ó 3/4 = 3/8), luego suma 3/8 + 1/6 usando m√©todo mariposa',
                emoji: 'üî¢'
            },
            {
                display: '2/3 - (1/4 √ó 2/5)', 
                equation: '2/3 - (1/4 √ó 2/5)',
                solution: [23, 30], // 2/3 - 2/20 = 2/3 - 1/10 = 20/30 - 3/30 = 17/30... let me double check
                hint: 'Resuelve primero el par√©ntesis (1/4 √ó 2/5 = 2/20 = 1/10), luego resta 2/3 - 1/10',
                emoji: '‚ö°'
            },
            {
                display: '(3/5 √∑ 2/3) + 1/10',
                equation: '(3/5 √∑ 2/3) + 1/10', 
                solution: [19, 20], // 3/5 √ó 3/2 = 9/10, then 9/10 + 1/10 = 10/10 = 1 = 20/20... wait 9/10 + 1/10 = 10/10 = 1
                hint: 'Para dividir, invierte y multiplica: 3/5 √∑ 2/3 = 3/5 √ó 3/2, luego suma el resultado con 1/10',
                emoji: 'üöÄ'
            },
            {
                display: '1/2 + (3/8 √ó 4/9)',
                equation: '1/2 + (3/8 √ó 4/9)',
                solution: [5, 6], // 3/8 √ó 4/9 = 12/72 = 1/6, then 1/2 + 1/6 = 3/6 + 1/6 = 4/6 = 2/3
                hint: 'Multiplica primero 3/8 √ó 4/9 (puedes simplificar antes), luego suma con 1/2',
                emoji: '‚≠ê'
            },
            {
                display: '(5/6 - 1/4) √ó 2/3',
                equation: '(5/6 - 1/4) √ó 2/3',
                solution: [5, 18], // 5/6 - 1/4 = 20/24 - 6/24 = 14/24 = 7/12, then 7/12 √ó 2/3 = 14/36 = 7/18
                hint: 'Primero resta usando m√©todo mariposa: 5/6 - 1/4, luego multiplica el resultado por 2/3',
                emoji: 'üéØ'
            }
        ];

        // Let me recalculate these to make sure they're correct
        function recalculateChallengeAnswers() {
            // Problem 1: (1/2 √ó 3/4) + 1/6
            // 1/2 √ó 3/4 = 3/8
            // 3/8 + 1/6 = (3√ó6 + 1√ó8)/(8√ó6) = (18+8)/48 = 26/48 = 13/24
            challengeProblems[0].solution = [13, 24];

            // Problem 2: 2/3 - (1/4 √ó 2/5)
            // 1/4 √ó 2/5 = 2/20 = 1/10
            // 2/3 - 1/10 = (2√ó10 - 1√ó3)/(3√ó10) = (20-3)/30 = 17/30
            challengeProblems[1].solution = [17, 30];

            // Problem 3: (3/5 √∑ 2/3) + 1/10
            // 3/5 √∑ 2/3 = 3/5 √ó 3/2 = 9/10
            // 9/10 + 1/10 = 10/10 = 1
            challengeProblems[2].solution = [1, 1];

            // Problem 4: 1/2 + (3/8 √ó 4/9)
            // 3/8 √ó 4/9 = 12/72 = 1/6
            // 1/2 + 1/6 = (1√ó6 + 1√ó2)/(2√ó6) = (6+2)/12 = 8/12 = 2/3
            challengeProblems[3].solution = [2, 3];

            // Problem 5: (5/6 - 1/4) √ó 2/3
            // 5/6 - 1/4 = (5√ó4 - 1√ó6)/(6√ó4) = (20-6)/24 = 14/24 = 7/12
            // 7/12 √ó 2/3 = 14/36 = 7/18
            challengeProblems[4].solution = [7, 18];
        }

        function startChallenge() {
            recalculateChallengeAnswers();
            
            challengeState = {
                currentProblem: 0,
                score: 0,
                correct: 0,
                streak: 0,
                timer: null,
                timeLeft: 60,
                problems: [...challengeProblems],
                started: true
            };

            document.getElementById('challenge-start').classList.add('hidden');
            document.getElementById('challenge-interface').classList.remove('hidden');

            startChallengeProblem();
        }

        function startChallengeProblem() {
            if (challengeState.currentProblem >= challengeState.problems.length) {
                finishChallenge();
                return;
            }

            const problem = challengeState.problems[challengeState.currentProblem];
            challengeState.timeLeft = 60;

            // Update progress
            const progress = ((challengeState.currentProblem + 1) / challengeState.problems.length) * 100;
            document.getElementById('challenge-progress').textContent = `${challengeState.currentProblem + 1}/5`;
            document.getElementById('challenge-progress-bar').style.width = progress + '%';

            // Update problem display
            document.getElementById('challenge-emoji').textContent = problem.emoji;
            document.getElementById('challenge-question-title').textContent = `Problema ${challengeState.currentProblem + 1}`;
            document.getElementById('challenge-problem').innerHTML = problem.display;

            // Generate options
            generateChallengeOptions(problem.solution);

            // Hide hint
            document.getElementById('challenge-hint').classList.add('hidden');

            // Start timer
            if (challengeState.timer) clearInterval(challengeState.timer);
            challengeState.timer = setInterval(() => {
                challengeState.timeLeft--;
                document.getElementById('challenge-time').textContent = challengeState.timeLeft;
                
                if (challengeState.timeLeft <= 0) {
                    // Time's up, move to next problem
                    nextChallengeProblem(false);
                }
            }, 1000);

            updateChallengeStats();
        }

        function generateChallengeOptions(correctAnswer) {
            const options = [correctAnswer];
            
            // Generate 3 wrong answers
            while (options.length < 4) {
                let wrongNum, wrongDen;
                
                // Generate plausible wrong answers
                if (Math.random() < 0.5) {
                    // Modify numerator
                    wrongNum = Math.max(1, correctAnswer[0] + Math.floor(Math.random() * 6) - 3);
                    wrongDen = correctAnswer[1];
                } else {
                    // Modify denominator  
                    wrongNum = correctAnswer[0];
                    wrongDen = Math.max(1, correctAnswer[1] + Math.floor(Math.random() * 6) - 3);
                }
                
                const wrong = simplifyFraction(wrongNum, wrongDen);
                if (!options.some(opt => opt[0] === wrong[0] && opt[1] === wrong[1])) {
                    options.push(wrong);
                }
            }

            // Shuffle options
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }

            const optionsHtml = options.map((option, index) => {
                const displayText = option[1] === 1 ? option[0].toString() : 
                    `<span class="fraction"><span class="numerator">${option[0]}</span><span class="denominator">${option[1]}</span></span>`;
                
                return `
                <button onclick="checkChallengeAnswer(${option[0]}, ${option[1]})" 
                        class="challenge-option bg-gradient-to-r from-orange-400 to-red-500 text-white p-4 rounded-xl hover:from-orange-500 hover:to-red-600 transition-all transform hover:scale-105 shadow-lg text-xl">
                    ${displayText}
                </button>
            `;
            }).join('');

            document.getElementById('challenge-options').innerHTML = optionsHtml;
        }

        function checkChallengeAnswer(selectedNum, selectedDen) {
            if (challengeState.timer) {
                clearInterval(challengeState.timer);
                challengeState.timer = null;
            }

            const problem = challengeState.problems[challengeState.currentProblem];
            const correct = problem.solution;
            const isCorrect = selectedNum === correct[0] && selectedDen === correct[1];

            // Disable all buttons and show results
            document.querySelectorAll('.challenge-option').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('pointer-events-none');
                
                // Parse the selected answer from button
                const isThisButton = btn.onclick.toString().includes(`${selectedNum}, ${selectedDen}`);
                
                if (isThisButton) {
                    if (isCorrect) {
                        btn.classList.remove('from-orange-400', 'to-red-500');
                        btn.classList.add('from-green-500', 'to-emerald-600', 'animate-pop');
                    } else {
                        btn.classList.remove('from-orange-400', 'to-red-500');
                        btn.classList.add('from-red-600', 'to-red-700');
                    }
                } else if (!isCorrect) {
                    // Show correct answer
                    const isCorrectButton = btn.onclick.toString().includes(`${correct[0]}, ${correct[1]}`);
                    if (isCorrectButton) {
                        btn.classList.remove('from-orange-400', 'to-red-500');
                        btn.classList.add('from-green-500', 'to-emerald-600');
                    }
                }
            });

            if (isCorrect) {
                challengeState.correct++;
                challengeState.streak++;
                challengeState.score += 100 + (challengeState.timeLeft * 2); // Bonus for speed
                createMiniConfetti();
            } else {
                challengeState.streak = 0;
            }

            updateChallengeStats();

            setTimeout(() => {
                nextChallengeProblem(isCorrect);
            }, 2000);
        }

        function nextChallengeProblem(wasCorrect) {
            challengeState.currentProblem++;
            
            if (challengeState.currentProblem >= challengeState.problems.length) {
                finishChallenge();
            } else {
                startChallengeProblem();
            }
        }

        function showHint() {
            const problem = challengeState.problems[challengeState.currentProblem];
            document.getElementById('challenge-hint-text').textContent = problem.hint;
            document.getElementById('challenge-hint').classList.remove('hidden');
            
            // Disable hint button
            document.getElementById('hint-btn').disabled = true;
            document.getElementById('hint-btn').classList.add('opacity-50');
        }

        function finishChallenge() {
            if (challengeState.timer) {
                clearInterval(challengeState.timer);
                challengeState.timer = null;
            }

            // Calculate final stats
            const accuracy = (challengeState.correct / challengeState.problems.length) * 100;
            const xpEarned = challengeState.score / 10 + 200; // Base 200 XP for completing
            
            addXP(xpEarned);
            addPoints(challengeState.score);

            document.getElementById('challenge-interface').classList.add('hidden');
            document.getElementById('challenge-results').classList.remove('hidden');

            document.getElementById('challenge-final-stats').innerHTML = `
                <div class="space-y-3">
                    <p><strong>Respuestas correctas:</strong> ${challengeState.correct}/5</p>
                    <p><strong>Precisi√≥n:</strong> ${accuracy.toFixed(1)}%</p>
                    <p><strong>Puntuaci√≥n final:</strong> ${challengeState.score}</p>
                    <p><strong>Racha m√°xima:</strong> ${Math.max(...Array.from({length: challengeState.problems.length}, (_, i) => challengeState.streak))}</p>
                    <p class="text-green-600 font-bold"><strong>XP ganado:</strong> +${xpEarned}</p>
                    <div class="text-2xl mt-4">
                        ${accuracy >= 80 ? 'üèÜ ¬°Maestro de las fracciones!' : 
                          accuracy >= 60 ? '‚≠ê ¬°Excelente trabajo!' : 
                          accuracy >= 40 ? 'üëç ¬°Buen esfuerzo!' : 'üí™ ¬°Sigue practicando!'}
                    </div>
                </div>
            `;

            createConfetti();
            showNotification(`üéâ Desaf√≠o completado: +${xpEarned} XP!`, 'success');
        }

        function updateChallengeStats() {
            document.getElementById('challenge-score').textContent = challengeState.score;
            document.getElementById('challenge-correct').textContent = challengeState.correct;
            document.getElementById('challenge-streak').textContent = challengeState.streak;
        }

        function exitChallenge() {
            if (challengeState.timer) {
                clearInterval(challengeState.timer);
                challengeState.timer = null;
            }

            document.getElementById('challenge-start').classList.remove('hidden');
            document.getElementById('challenge-interface').classList.add('hidden');
            document.getElementById('challenge-results').classList.add('hidden');

            challengeState.started = false;
        }

        // Practice System
        let practiceState = {
            currentExercise: 0,
            completed: 0,
            correct: 0,
            exercises: [],
            started: false,
            showingResult: false
        };

        // 10 Mixed Practice Exercises with detailed solutions
        const practiceExercises = [
            {
                display: '1/2 + 1/3',
                type: 'Suma con denominadores diferentes',
                solution: [5, 6],
                hint: 'Usa el m√©todo mariposa: (1√ó3) + (1√ó2) = 3+2 = 5, denominador: 2√ó3 = 6',
                explanation: 'Para sumar fracciones con denominadores diferentes, usamos el m√©todo mariposa. Multiplicamos 1√ó3=3 y 1√ó2=2, sumamos: 3+2=5. El denominador es 2√ó3=6. Resultado: 5/6.',
                emoji: '‚ûï'
            },
            {
                display: '3/4 - 1/6',
                type: 'Resta con m√©todo mariposa',
                solution: [7, 12],
                hint: 'M√©todo mariposa: (3√ó6) - (1√ó4) = 18-4 = 14, denominador: 4√ó6 = 24. Luego simplifica 14/24',
                explanation: 'Aplicamos el m√©todo mariposa: (3√ó6) - (1√ó4) = 18-4 = 14, denominador: 4√ó6 = 24. Tenemos 14/24. Simplificamos dividiendo entre 2: 14√∑2=7, 24√∑2=12. Resultado: 7/12.',
                emoji: '‚ûñ'
            },
            {
                display: '2/3 √ó 3/4',
                type: 'Multiplicaci√≥n directa',
                solution: [1, 2],
                hint: 'Multiplica numeradores: 2√ó3=6, denominadores: 3√ó4=12, luego simplifica 6/12',
                explanation: 'Para multiplicar fracciones, multiplicamos numeradores entre s√≠ y denominadores entre s√≠: (2√ó3)/(3√ó4) = 6/12. Simplificamos dividiendo entre 6: 6√∑6=1, 12√∑6=2. Resultado: 1/2.',
                emoji: '‚úñÔ∏è'
            },
            {
                display: '5/8 √∑ 2/3',
                type: 'Divisi√≥n (invertir y multiplicar)',
                solution: [15, 16],
                hint: 'Invierte la segunda fracci√≥n: 2/3 ‚Üí 3/2, luego multiplica: 5/8 √ó 3/2',
                explanation: 'Para dividir fracciones, invertimos la segunda fracci√≥n y multiplicamos: 5/8 √∑ 2/3 = 5/8 √ó 3/2. Multiplicamos: (5√ó3)/(8√ó2) = 15/16. Ya est√° simplificado.',
                emoji: '‚ûó'
            },
            {
                display: '(1/2 + 1/4) √ó 2',
                type: 'Operaciones combinadas con par√©ntesis',
                solution: [3, 2],
                hint: 'Primero resuelve el par√©ntesis: 1/2 + 1/4, luego multiplica el resultado por 2',
                explanation: 'Primero resolvemos el par√©ntesis: 1/2 + 1/4 = 2/4 + 1/4 = 3/4. Luego multiplicamos por 2: 3/4 √ó 2 = 3/4 √ó 2/1 = 6/4 = 3/2.',
                emoji: 'üî¢'
            },
            {
                display: '7/10 - 2/5',
                type: 'Resta con denominador com√∫n',
                solution: [3, 10],
                hint: 'Convierte 2/5 a d√©cimos: 2/5 = 4/10, luego resta: 7/10 - 4/10',
                explanation: 'Convertimos 2/5 a d√©cimos: 2/5 = 4/10 (multiplicando numerador y denominador por 2). Ahora restamos: 7/10 - 4/10 = 3/10.',
                emoji: 'üîß'
            },
            {
                display: '3/5 √ó 10/9',
                type: 'Multiplicaci√≥n con simplificaci√≥n',
                solution: [2, 3],
                hint: 'Puedes simplificar antes de multiplicar: 3 y 9 tienen factor com√∫n, 5 y 10 tambi√©n',
                explanation: 'Podemos simplificar antes de multiplicar: 3/5 √ó 10/9. Cancelamos: 3 y 9 (divido entre 3), 5 y 10 (divido entre 5). Nos queda: 1/1 √ó 2/3 = 2/3.',
                emoji: '‚ö°'
            },
            {
                display: '2/3 √∑ 4',
                type: 'Divisi√≥n entre n√∫mero entero',
                solution: [1, 6],
                hint: 'Convierte 4 a fracci√≥n: 4 = 4/1, luego invierte: 4/1 ‚Üí 1/4, y multiplica',
                explanation: 'Para dividir entre un entero, lo convertimos a fracci√≥n: 4 = 4/1. Invertimos: 1/4. Multiplicamos: 2/3 √ó 1/4 = (2√ó1)/(3√ó4) = 2/12 = 1/6.',
                emoji: 'üìê'
            },
            {
                display: '1/3 + 1/4 + 1/6',
                type: 'Suma de tres fracciones',
                solution: [3, 4],
                hint: 'Busca el denominador com√∫n de 3, 4 y 6. El MCM es 12',
                explanation: 'Encontramos el MCM de 3, 4 y 6, que es 12. Convertimos: 1/3=4/12, 1/4=3/12, 1/6=2/12. Sumamos: 4/12 + 3/12 + 2/12 = 9/12 = 3/4.',
                emoji: 'üßÆ'
            },
            {
                display: '(3/4 - 1/2) √∑ (1/8)',
                type: 'Operaci√≥n compleja con par√©ntesis',
                solution: [2, 1],
                hint: 'Resuelve cada par√©ntesis: (3/4 - 1/2) y luego divide entre 1/8',
                explanation: 'Primero resolvemos: 3/4 - 1/2 = 3/4 - 2/4 = 1/4. Luego dividimos: 1/4 √∑ 1/8 = 1/4 √ó 8/1 = 8/4 = 2. Resultado: 2 (o 2/1).',
                emoji: 'üéØ'
            }
        ];

        function startDigitalPractice() {
            practiceState = {
                currentExercise: 0,
                completed: 0,
                correct: 0,
                exercises: [...practiceExercises],
                started: true,
                showingResult: false
            };

            document.getElementById('practice-mode-selection').classList.add('hidden');
            document.getElementById('digital-practice').classList.remove('hidden');

            showPracticeExercise();
        }

        function showPracticeExercise() {
            if (practiceState.currentExercise >= practiceState.exercises.length) {
                completePractice();
                return;
            }

            const exercise = practiceState.exercises[practiceState.currentExercise];
            const progress = ((practiceState.currentExercise + 1) / practiceState.exercises.length) * 100;

            // Update progress
            document.getElementById('practice-progress').textContent = `${practiceState.currentExercise + 1}/10`;
            document.getElementById('practice-progress-bar').style.width = progress + '%';

            // Update display
            document.getElementById('practice-emoji').textContent = exercise.emoji;
            document.getElementById('practice-title').textContent = `Ejercicio ${practiceState.currentExercise + 1}: ${exercise.type}`;
            document.getElementById('practice-exercise').textContent = exercise.display;

            // Reset inputs
            document.getElementById('answer-numerator').value = '';
            document.getElementById('answer-denominator').value = '';

            // Hide hint and result
            document.getElementById('practice-hint').classList.add('hidden');
            document.getElementById('practice-result').classList.add('hidden');
            
            // Enable hint button
            document.getElementById('practice-hint-btn').disabled = false;
            document.getElementById('practice-hint-btn').classList.remove('opacity-50');

            practiceState.showingResult = false;
        }

        function checkPracticeAnswer() {
            if (practiceState.showingResult) return;

            const numInput = document.getElementById('answer-numerator');
            const denInput = document.getElementById('answer-denominator');
            
            const userNum = parseInt(numInput.value);
            const userDen = parseInt(denInput.value) || 1;

            if (isNaN(userNum) || userDen <= 0) {
                showCustomAlert('Por favor ingresa n√∫meros v√°lidos');
                return;
            }

            const exercise = practiceState.exercises[practiceState.currentExercise];
            const correctAnswer = exercise.solution;
            
            // Simplify user answer
            const userAnswerSimplified = simplifyFraction(userNum, userDen);
            const isCorrect = userAnswerSimplified[0] === correctAnswer[0] && userAnswerSimplified[1] === correctAnswer[1];

            practiceState.showingResult = true;

            // Show result
            document.getElementById('practice-result').classList.remove('hidden');
            
            if (isCorrect) {
                practiceState.correct++;
                document.getElementById('practice-feedback').innerHTML = `
                    <span class="text-green-600">‚úÖ ¬°Correcto! Excelente trabajo</span>
                `;
                createMiniConfetti();
            } else {
                document.getElementById('practice-feedback').innerHTML = `
                    <span class="text-red-600">‚ùå Incorrecto</span><br>
                    <span class="text-blue-600">Respuesta correcta: ${correctAnswer[1] === 1 ? correctAnswer[0] : correctAnswer[0] + '/' + correctAnswer[1]}</span>
                `;
            }

            document.getElementById('practice-explanation').innerHTML = `
                <h6 class="font-bold mb-2">üìö Explicaci√≥n paso a paso:</h6>
                <p class="text-sm">${exercise.explanation}</p>
            `;

            practiceState.completed++;
            updatePracticeStats();
        }

        function showPracticeHint() {
            const exercise = practiceState.exercises[practiceState.currentExercise];
            document.getElementById('practice-hint-text').textContent = exercise.hint;
            document.getElementById('practice-hint').classList.remove('hidden');
            
            // Disable hint button
            document.getElementById('practice-hint-btn').disabled = true;
            document.getElementById('practice-hint-btn').classList.add('opacity-50');
        }

        function skipExercise() {
            if (!practiceState.showingResult) {
                practiceState.completed++;
                updatePracticeStats();
            }
            nextPracticeExercise();
        }

        function nextPracticeExercise() {
            practiceState.currentExercise++;
            
            if (practiceState.currentExercise >= practiceState.exercises.length) {
                completePractice();
            } else {
                showPracticeExercise();
            }
        }

        function completePractice() {
            const accuracy = (practiceState.correct / practiceState.exercises.length) * 100;
            const xpEarned = practiceState.correct * 20 + 100; // Base 100 XP + 20 per correct
            
            addXP(xpEarned);
            addPoints(practiceState.correct * 50);

            document.getElementById('digital-practice').classList.add('hidden');
            document.getElementById('practice-complete').classList.remove('hidden');

            document.getElementById('practice-final-stats').innerHTML = `
                <div class="space-y-3">
                    <p><strong>Ejercicios completados:</strong> ${practiceState.exercises.length}/10</p>
                    <p><strong>Respuestas correctas:</strong> ${practiceState.correct}/10</p>
                    <p><strong>Precisi√≥n:</strong> ${accuracy.toFixed(1)}%</p>
                    <p class="text-green-600 font-bold"><strong>XP ganado:</strong> +${xpEarned}</p>
                    <div class="text-3xl mt-4">
                        ${accuracy >= 90 ? 'üèÜ ¬°Maestro absoluto!' : 
                          accuracy >= 80 ? '‚≠ê ¬°Excelente dominio!' : 
                          accuracy >= 70 ? 'üéØ ¬°Muy buen trabajo!' : 
                          accuracy >= 60 ? 'üëç ¬°Buen progreso!' : 'üí™ ¬°Sigue practicando!'}
                    </div>
                </div>
            `;

            createConfetti();
            showNotification(`üéâ Pr√°ctica completada: +${xpEarned} XP!`, 'success');
        }

        function updatePracticeStats() {
            const accuracy = practiceState.completed > 0 ? (practiceState.correct / practiceState.completed) * 100 : 0;
            const xpEarned = practiceState.correct * 20;

            document.getElementById('practice-completed').textContent = practiceState.completed;
            document.getElementById('practice-correct').textContent = practiceState.correct;
            document.getElementById('practice-accuracy').textContent = accuracy.toFixed(1) + '%';
            document.getElementById('practice-xp').textContent = xpEarned;
        }

        function exitPractice() {
            document.getElementById('practice-mode-selection').classList.remove('hidden');
            document.getElementById('digital-practice').classList.add('hidden');
            document.getElementById('practice-complete').classList.add('hidden');
            
            practiceState.started = false;
        }

        // Function to ensure practice section shows correctly
        function resetPracticeSection() {
            document.getElementById('practice-mode-selection').classList.remove('hidden');
            document.getElementById('digital-practice').classList.add('hidden');
            document.getElementById('practice-complete').classList.add('hidden');
            
            // Reset practice state
            practiceState = {
                currentExercise: 0,
                completed: 0,
                correct: 0,
                exercises: [],
                started: false,
                showingResult: false
            };
            
            // Reset UI stats
            document.getElementById('practice-completed').textContent = '0';
            document.getElementById('practice-correct').textContent = '0';
            document.getElementById('practice-accuracy').textContent = '0%';
            document.getElementById('practice-xp').textContent = '0';
        }

        // Worksheet Generation System
        function generateWorksheet() {
            const worksheetExercises = generateWorksheetExercises();
            const worksheetHTML = createWorksheetHTML(worksheetExercises);
            
            document.getElementById('worksheet-content').innerHTML = worksheetHTML;
            document.getElementById('worksheet-modal').classList.remove('hidden');
        }

        function generateWorksheetExercises() {
            // Generate 10 random exercises similar to practice but different numbers
            const exercises = [];
            const types = [
                { type: 'add_different', name: 'Suma con denominadores diferentes', count: 2 },
                { type: 'subtract_butterfly', name: 'Resta con m√©todo mariposa', count: 2 },
                { type: 'multiply_direct', name: 'Multiplicaci√≥n directa', count: 2 },
                { type: 'divide_invert', name: 'Divisi√≥n (invertir y multiplicar)', count: 1 },
                { type: 'combined_operations', name: 'Operaciones combinadas', count: 2 },
                { type: 'three_fractions', name: 'Suma de tres fracciones', count: 1 }
            ];

            types.forEach(category => {
                for (let i = 0; i < category.count; i++) {
                    exercises.push(generateExerciseByType(category.type, category.name));
                }
            });

            return exercises;
        }

        function generateExerciseByType(type, typeName) {
            let exercise = { type: typeName };
            
            switch(type) {
                case 'add_different':
                    const num1 = Math.floor(Math.random() * 5) + 1;
                    const den1 = Math.floor(Math.random() * 8) + 2;
                    const num2 = Math.floor(Math.random() * 5) + 1;
                    const den2 = Math.floor(Math.random() * 8) + 2;
                    
                    if (den1 !== den2) {
                        exercise.problem = `${num1}/${den1} + ${num2}/${den2}`;
                        exercise.solution = simplifyFraction((num1 * den2) + (num2 * den1), den1 * den2);
                    } else {
                        exercise.problem = `${num1}/${den1} + ${num2}/${den2 + 1}`;
                        exercise.solution = simplifyFraction((num1 * (den2 + 1)) + (num2 * den1), den1 * (den2 + 1));
                    }
                    break;

                case 'subtract_butterfly':
                    const sNum1 = Math.floor(Math.random() * 7) + 2;
                    const sDen1 = Math.floor(Math.random() * 6) + 2;
                    const sNum2 = Math.floor(Math.random() * 5) + 1;
                    const sDen2 = Math.floor(Math.random() * 6) + 2;
                    
                    // Ensure result is positive
                    if ((sNum1 * sDen2) >= (sNum2 * sDen1)) {
                        exercise.problem = `${sNum1}/${sDen1} - ${sNum2}/${sDen2}`;
                        exercise.solution = simplifyFraction((sNum1 * sDen2) - (sNum2 * sDen1), sDen1 * sDen2);
                    } else {
                        exercise.problem = `${sNum2}/${sDen2} - ${sNum1}/${sDen1}`;
                        exercise.solution = simplifyFraction((sNum2 * sDen1) - (sNum1 * sDen2), sDen1 * sDen2);
                    }
                    break;

                case 'multiply_direct':
                    const mNum1 = Math.floor(Math.random() * 6) + 1;
                    const mDen1 = Math.floor(Math.random() * 8) + 2;
                    const mNum2 = Math.floor(Math.random() * 6) + 1;
                    const mDen2 = Math.floor(Math.random() * 8) + 2;
                    
                    exercise.problem = `${mNum1}/${mDen1} √ó ${mNum2}/${mDen2}`;
                    exercise.solution = simplifyFraction(mNum1 * mNum2, mDen1 * mDen2);
                    break;

                case 'divide_invert':
                    const dNum1 = Math.floor(Math.random() * 6) + 1;
                    const dDen1 = Math.floor(Math.random() * 8) + 2;
                    const dNum2 = Math.floor(Math.random() * 5) + 1;
                    const dDen2 = Math.floor(Math.random() * 6) + 2;
                    
                    exercise.problem = `${dNum1}/${dDen1} √∑ ${dNum2}/${dDen2}`;
                    exercise.solution = simplifyFraction(dNum1 * dDen2, dDen1 * dNum2);
                    break;

                case 'combined_operations':
                    const operations = [
                        () => {
                            const a = Math.floor(Math.random() * 3) + 1;
                            const b = Math.floor(Math.random() * 6) + 2;
                            const c = Math.floor(Math.random() * 3) + 1;
                            const d = Math.floor(Math.random() * 6) + 2;
                            const e = Math.floor(Math.random() * 4) + 2;
                            
                            return {
                                problem: `(${a}/${b} + ${c}/${d}) √ó ${e}`,
                                solution: (() => {
                                    const sum = simplifyFraction((a * d) + (c * b), b * d);
                                    return simplifyFraction(sum[0] * e, sum[1]);
                                })()
                            };
                        },
                        () => {
                            const a = Math.floor(Math.random() * 5) + 2;
                            const b = Math.floor(Math.random() * 6) + 2;
                            const c = Math.floor(Math.random() * 3) + 1;
                            const d = Math.floor(Math.random() * 6) + 2;
                            
                            return {
                                problem: `${a}/${b} - (${c}/${d} √ó 2)`,
                                solution: (() => {
                                    const product = simplifyFraction(c * 2, d);
                                    return simplifyFraction((a * product[1]) - (product[0] * b), b * product[1]);
                                })()
                            };
                        }
                    ];
                    
                    const selectedOp = operations[Math.floor(Math.random() * operations.length)]();
                    exercise.problem = selectedOp.problem;
                    exercise.solution = selectedOp.solution;
                    break;

                case 'three_fractions':
                    const t1 = Math.floor(Math.random() * 3) + 1;
                    const td1 = Math.floor(Math.random() * 5) + 3;
                    const t2 = Math.floor(Math.random() * 3) + 1;
                    const td2 = Math.floor(Math.random() * 5) + 3;
                    const t3 = Math.floor(Math.random() * 3) + 1;
                    const td3 = Math.floor(Math.random() * 5) + 3;
                    
                    exercise.problem = `${t1}/${td1} + ${t2}/${td2} + ${t3}/${td3}`;
                    // For simplicity, we'll calculate step by step
                    const sum1 = simplifyFraction((t1 * td2) + (t2 * td1), td1 * td2);
                    exercise.solution = simplifyFraction((sum1[0] * td3) + (t3 * sum1[1]), sum1[1] * td3);
                    break;
            }
            
            return exercise;
        }

        function createWorksheetHTML(exercises) {
            const currentDate = new Date().toLocaleDateString('es-ES');
            
            return `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: white; color: black;">
                    <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #5D5CDE; padding-bottom: 20px;">
                        <h1 style="font-size: 28px; color: #5D5CDE; margin-bottom: 10px;">üéÆ Fracci√≥n Quest - Hoja de Pr√°ctica</h1>
                        <h2 style="font-size: 18px; color: #666; margin-bottom: 15px;">Ejercicios Mixtos de Fracciones</h2>
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 14px; color: #888;">
                            <span>Fecha: ${currentDate}</span>
                            <span>Nombre: ________________________</span>
                            <span>Puntuaci√≥n: ____/10</span>
                        </div>
                    </div>

                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 25px;">
                        <h3 style="color: #5D5CDE; margin-bottom: 10px;">üìã Instrucciones:</h3>
                        <ul style="margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.6;">
                            <li>Resuelve cada ejercicio paso a paso</li>
                            <li>Simplifica todas las fracciones al resultado final</li>
                            <li>Si el resultado es una fracci√≥n impropia, puedes convertirla a n√∫mero mixto</li>
                            <li>Usa el espacio en blanco para mostrar tu trabajo</li>
                            <li>Recuerda: para denominadores diferentes usa el m√©todo mariposa</li>
                        </ul>
                    </div>

                    <div style="display: grid; gap: 25px;">
                        ${exercises.map((exercise, index) => `
                            <div style="border: 2px solid #e5e7eb; border-radius: 10px; padding: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: #5D5CDE; margin: 0; font-size: 16px;">Ejercicio ${index + 1}</h4>
                                    <span style="background: #e5e7eb; padding: 5px 10px; border-radius: 15px; font-size: 12px; color: #666;">${exercise.type}</span>
                                </div>
                                
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <div style="font-size: 18px; font-weight: bold; text-align: center; margin-bottom: 10px;">
                                        ${exercise.problem} = ________________
                                    </div>
                                </div>
                                
                                <div style="border-top: 1px solid #e5e7eb; padding-top: 15px;">
                                    <p style="margin: 0; font-size: 12px; color: #666;">Espacio para el desarrollo:</p>
                                    <div style="min-height: 60px; border: 1px dashed #ccc; margin-top: 5px; padding: 10px;"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div style="margin-top: 30px; border-top: 2px solid #5D5CDE; padding-top: 20px;">
                        <h3 style="color: #5D5CDE; margin-bottom: 15px;">üìñ Recordatorio de M√©todos:</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 12px;">
                            <div style="background: #f0f9ff; padding: 15px; border-radius: 8px;">
                                <h4 style="color: #0369a1; margin-bottom: 8px;">‚ûï‚ûñ Suma y Resta</h4>
                                <p><strong>Denominadores iguales:</strong> Suma/resta numeradores</p>
                                <p><strong>Denominadores diferentes:</strong> M√©todo mariposa</p>
                                <p style="text-align: center; font-family: monospace;">a/b ¬± c/d = (a√ód ¬± c√ób)/(b√ód)</p>
                            </div>
                            <div style="background: #fef3f2; padding: 15px; border-radius: 8px;">
                                <h4 style="color: #dc2626; margin-bottom: 8px;">‚úñÔ∏è‚ûó Multiplicaci√≥n y Divisi√≥n</h4>
                                <p><strong>Multiplicaci√≥n:</strong> a/b √ó c/d = (a√óc)/(b√ód)</p>
                                <p><strong>Divisi√≥n:</strong> a/b √∑ c/d = a/b √ó d/c</p>
                                <p><em>Tip: Simplifica antes de multiplicar</em></p>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 20px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #e5e7eb; padding-top: 15px;">
                        <p>üéÆ Generado por Fracci√≥n Quest - Tu aventura matem√°tica contin√∫a en digital</p>
                        <p>Para m√°s pr√°ctica interactiva, regresa a la aplicaci√≥n web</p>
                    </div>
                </div>
            `;
        }

        function printWorksheet() {
            const printWindow = window.open('', '_blank');
            const worksheetContent = document.getElementById('worksheet-content').innerHTML;
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Fracci√≥n Quest - Hoja de Pr√°ctica</title>
                    <style>
                        @media print {
                            body { margin: 0; }
                            @page { size: A4; margin: 0.5in; }
                        }
                    </style>
                </head>
                <body>
                    ${worksheetContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }

        function downloadWorksheet() {
            // Create worksheet for download (only exercises, no answers)
            const exercises = generateWorksheetExercises();
            const worksheetHTML = createDownloadableWorksheet(exercises);
            
            const blob = new Blob([worksheetHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fraccion-quest-ejercicios-${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function createDownloadableWorksheet(exercises) {
            const currentDate = new Date().toLocaleDateString('es-ES');
            
            return `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fracci√≥n Quest - Hoja de Pr√°ctica</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: white; color: black; }
        .exercise { border: 2px solid #e5e7eb; border-radius: 10px; padding: 20px; margin-bottom: 25px; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #5D5CDE; padding-bottom: 20px; }
        .instructions { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 25px; }
        @media print { 
            body { margin: 0; }
            @page { size: A4; margin: 0.5in; }
        }
    </style>
</head>
<body>
    ${createWorksheetHTML(exercises)}
</body>
</html>`;
        }

        function generateNewWorksheet() {
            // Force generation of completely new exercises
            const newExercises = generateWorksheetExercises();
            const newWorksheetHTML = createWorksheetHTML(newExercises);
            
            document.getElementById('worksheet-content').innerHTML = newWorksheetHTML;
            
            // Show notification that new exercises were generated
            showNotification('üìÑ ¬°Nueva hoja generada con ejercicios diferentes!', 'success');
        }

        function closeWorksheet() {
            document.getElementById('worksheet-modal').classList.add('hidden');
        }

        // Custom Alert Function (since alert() is not allowed)
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
